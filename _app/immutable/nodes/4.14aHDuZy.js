import{s as he,n as ge,x as Ge,o as Pe,y as je,i as Ye,e as we,r as Fe,k as Ze,z as Re,b as Je}from"../chunks/scheduler.BXvgzZK-.js";import{S as ve,i as pe,e as T,c as C,d as O,g as k,r as _,z as q,j as ne,A as te,s as j,m as ie,b as se,h as F,n as ae,f as re,k as v,o as oe,x as Te,v as Ce,l as fe,t as x,a as ee,p as ce,B as qe,C as Ee,D as ye,E as Ve,q as _e,F as Qe}from"../chunks/index.BQ0Ppj1p.js";import{P as be,e as ue,u as Ie,o as De,a as le,d as xe,b as Ke}from"../chunks/public.DaMEbo7N.js";import{g as Ae,b as et,a as tt}from"../chunks/obr-host.CvGELXpw.js";import{i as nt,p as lt,r as Me,P as it,c as st,a as at,b as rt,R as ot,g as Ne}from"../chunks/roll-formula.BB4CBsVT.js";import{w as ct,i as Xe}from"../chunks/util.D_TvH_I6.js";function ut(l){let e,t,n,a;return{c(){e=T("button"),this.h()},l(i){e=C(i,"BUTTON",{class:!0,style:!0,title:!0}),O(e).forEach(k),this.h()},h(){_(e,"class","component svelte-u3mkj0"),_(e,"style",t=`--icon: url("${be}/${l[0]}")`),_(e,"title",l[1]),q(e,"no-animate",l[2]),q(e,"fill",l[3])},m(i,o){ne(i,e,o),n||(a=te(e,"click",l[4]),n=!0)},p(i,[o]){o&1&&t!==(t=`--icon: url("${be}/${i[0]}")`)&&_(e,"style",t),o&2&&_(e,"title",i[1]),o&4&&q(e,"no-animate",i[2]),o&8&&q(e,"fill",i[3])},i:ge,o:ge,d(i){i&&k(e),n=!1,a()}}}function ft(l,e,t){let{iconPath:n}=e,{title:a=null}=e,{noAnimate:i=!1}=e,{fillContainer:o=!1}=e;function f(c){Ge.call(this,l,c)}return l.$$set=c=>{"iconPath"in c&&t(0,n=c.iconPath),"title"in c&&t(1,a=c.title),"noAnimate"in c&&t(2,i=c.noAnimate),"fillContainer"in c&&t(3,o=c.fillContainer)},[n,a,i,o,f]}class me extends ve{constructor(e){super(),pe(this,e,ft,ut,he,{iconPath:0,title:1,noAnimate:2,fillContainer:3})}}function dt(l){let e,t;return{c(){e=T("div"),this.h()},l(n){e=C(n,"DIV",{class:!0,style:!0,title:!0}),O(e).forEach(k),this.h()},h(){_(e,"class","component svelte-lv9ljo"),_(e,"style",t=`--icon: url("${be}/${l[0]}")`),_(e,"title",l[1])},m(n,a){ne(n,e,a)},p(n,[a]){a&1&&t!==(t=`--icon: url("${be}/${n[0]}")`)&&_(e,"style",t),a&2&&_(e,"title",n[1])},i:ge,o:ge,d(n){n&&k(e)}}}function ht(l,e,t){let{iconPath:n}=e,{title:a=null}=e;return l.$$set=i=>{"iconPath"in i&&t(0,n=i.iconPath),"title"in i&&t(1,a=i.title)},[n,a]}class vt extends ve{constructor(e){super(),pe(this,e,ht,dt,he,{iconPath:0,title:1})}}function $e(l,e,t){const n=l.slice();n[31]=e[t],n[33]=e,n[34]=t;const a=n[1][n[31]];return n[32]=a,n}function pt(l){let e,t=l[32].initiative+"",n,a,i;function o(){return l[17](l[31])}return{c(){e=T("button"),n=se(t),this.h()},l(f){e=C(f,"BUTTON",{type:!0,class:!0});var c=O(e);n=re(c,t),c.forEach(k),this.h()},h(){_(e,"type","button"),_(e,"class","ordinal svelte-1w53t01")},m(f,c){ne(f,e,c),v(e,n),a||(i=te(e,"click",Ee(o)),a=!0)},p(f,c){l=f,c[0]&6&&t!==(t=l[32].initiative+"")&&fe(n,t)},d(f){f&&k(e),a=!1,i()}}}function _t(l){let e,t,n=l[31],a,i;function o(){l[12].call(t,l[31])}const f=()=>l[13](t,n),c=()=>l[13](null,n);function d(){return l[14](l[31])}function p(...D){return l[15](l[31],...D)}function L(){return l[16](l[31])}return{c(){e=T("form"),t=T("input"),this.h()},l(D){e=C(D,"FORM",{class:!0});var A=O(e);t=C(A,"INPUT",{class:!0,type:!0,step:!0}),A.forEach(k),this.h()},h(){_(t,"class","ordinal svelte-1w53t01"),_(t,"type","number"),_(t,"step","0.1"),_(e,"class","svelte-1w53t01")},m(D,A){ne(D,e,A),v(e,t),ye(t,l[1][l[31]].editContent),f(),a||(i=[te(t,"input",o),je(gt.call(null,t)),te(t,"blur",d),te(t,"keydown",p),te(e,"submit",Ee(L))],a=!0)},p(D,A){l=D,A[0]&6&&qe(t.value)!==l[1][l[31]].editContent&&ye(t,l[1][l[31]].editContent),n!==l[31]&&(c(),n=l[31],f())},d(D){D&&k(e),c(),a=!1,Fe(i)}}}function Oe(l,e){let t,n,a=e[32].name+"",i,o,f,c,d,p,L,D,A,E,P,z;function U(R,I){return R[32].editContent!==void 0?_t:pt}let N=U(e),S=N(e);function $(){return e[18](e[31])}return p=new me({props:{title:"View",iconPath:"eye.svg"}}),p.$on("click",$),{key:l,first:null,c(){t=T("div"),n=T("span"),i=se(a),o=j(),f=T("div"),S.c(),c=j(),d=T("div"),ie(p.$$.fragment),L=j(),this.h()},l(R){t=C(R,"DIV",{class:!0,title:!0});var I=O(t);n=C(I,"SPAN",{class:!0});var H=O(n);i=re(H,a),H.forEach(k),o=F(I),f=C(I,"DIV",{class:!0});var g=O(f);S.l(g),c=F(g),d=C(g,"DIV",{class:!0});var w=O(d);ae(p.$$.fragment,w),w.forEach(k),g.forEach(k),L=F(I),I.forEach(k),this.h()},h(){_(n,"class","content svelte-1w53t01"),_(d,"class","controls svelte-1w53t01"),_(f,"class","overlay svelte-1w53t01"),_(t,"class","entry svelte-1w53t01"),_(t,"title",D=`Initiative: ${e[32].initiative}`),q(t,"odd",e[34]%2!==0),q(t,"active",e[32].active),q(t,"editTarget",e[4]&&e[32].editContent!==void 0),this.first=t},m(R,I){ne(R,t,I),v(t,n),v(n,i),v(t,o),v(t,f),S.m(f,null),v(f,c),v(f,d),oe(p,d,null),v(t,L),E=!0,P||(z=je(A=e[5].call(null,t,e[31])),P=!0)},p(R,I){e=R,(!E||I[0]&6)&&a!==(a=e[32].name+"")&&fe(i,a),N===(N=U(e))&&S?S.p(e,I):(S.d(1),S=N(e),S&&(S.c(),S.m(f,c))),(!E||I[0]&6&&D!==(D=`Initiative: ${e[32].initiative}`))&&_(t,"title",D),A&&Ye(A.update)&&I[0]&4&&A.update.call(null,e[31]),(!E||I[0]&4)&&q(t,"odd",e[34]%2!==0),(!E||I[0]&6)&&q(t,"active",e[32].active),(!E||I[0]&22)&&q(t,"editTarget",e[4]&&e[32].editContent!==void 0)},i(R){E||(x(p.$$.fragment,R),E=!0)},o(R){ee(p.$$.fragment,R),E=!1},d(R){R&&k(t),S.d(),ce(p),P=!1,z()}}}function mt(l){let e,t,n=[],a=new Map,i,o,f,c,d,p,L=l[3]+1+"",D,A,E,P,z,U,N,S,$,R,I=ue(l[2]);const H=g=>g[31];for(let g=0;g<I.length;g+=1){let w=$e(l,I,g),M=H(w);a.set(M,n[g]=Oe(M,w))}return d=new vt({props:{title:"Round",iconPath:"checkered-flag.svg"}}),P=new me({props:{title:"Reset",iconPath:"undo.svg",noAnimate:!0,fillContainer:!0}}),P.$on("click",l[19]),N=new me({props:{title:"Previous player",iconPath:"backwards.svg"}}),N.$on("click",l[20]),$=new me({props:{title:"Next player",iconPath:"forwards.svg"}}),$.$on("click",l[21]),{c(){e=T("div"),t=T("div");for(let g=0;g<n.length;g+=1)n[g].c();i=j(),o=T("div"),f=T("div"),c=T("div"),ie(d.$$.fragment),p=j(),D=se(L),A=j(),E=T("div"),ie(P.$$.fragment),z=j(),U=T("div"),ie(N.$$.fragment),S=j(),ie($.$$.fragment),this.h()},l(g){e=C(g,"DIV",{class:!0});var w=O(e);t=C(w,"DIV",{class:!0});var M=O(t);for(let u=0;u<n.length;u+=1)n[u].l(M);M.forEach(k),i=F(w),o=C(w,"DIV",{class:!0});var K=O(o);f=C(K,"DIV",{class:!0});var G=O(f);c=C(G,"DIV",{class:!0});var B=O(c);ae(d.$$.fragment,B),p=F(B),D=re(B,L),B.forEach(k),A=F(G),E=C(G,"DIV",{class:!0});var Y=O(E);ae(P.$$.fragment,Y),Y.forEach(k),G.forEach(k),z=F(K),U=C(K,"DIV",{class:!0});var X=O(U);ae(N.$$.fragment,X),S=F(X),ae($.$$.fragment,X),X.forEach(k),K.forEach(k),w.forEach(k),this.h()},h(){_(t,"class","turns svelte-1w53t01"),q(t,"editing",l[4]),_(c,"class","content svelte-1w53t01"),_(E,"class","overlay svelte-1w53t01"),_(f,"class","round-count svelte-1w53t01"),_(U,"class","turn-controls svelte-1w53t01"),_(o,"class","controls svelte-1w53t01"),_(e,"class","component svelte-1w53t01"),q(e,"empty",l[0])},m(g,w){ne(g,e,w),v(e,t);for(let M=0;M<n.length;M+=1)n[M]&&n[M].m(t,null);v(e,i),v(e,o),v(o,f),v(f,c),oe(d,c,null),v(c,p),v(c,D),v(f,A),v(f,E),oe(P,E,null),v(o,z),v(o,U),oe(N,U,null),v(U,S),oe($,U,null),R=!0},p(g,w){w[0]&3862&&(I=ue(g[2]),Te(),n=Ie(n,w,H,1,g,I,a,t,De,Oe,null,$e),Ce()),(!R||w[0]&16)&&q(t,"editing",g[4]),(!R||w[0]&8)&&L!==(L=g[3]+1+"")&&fe(D,L),(!R||w[0]&1)&&q(e,"empty",g[0])},i(g){if(!R){for(let w=0;w<I.length;w+=1)x(n[w]);x(d.$$.fragment,g),x(P.$$.fragment,g),x(N.$$.fragment,g),x($.$$.fragment,g),R=!0}},o(g){for(let w=0;w<n.length;w+=1)ee(n[w]);ee(d.$$.fragment,g),ee(P.$$.fragment,g),ee(N.$$.fragment,g),ee($.$$.fragment,g),R=!1},d(g){g&&k(e);for(let w=0;w<n.length;w+=1)n[w].d();ce(d),ce(P),ce(N),ce($)}}}const de="rodeo.owlbear.initiative-tracker/metadata";function gt(l){l.focus(),l.select()}function wt(l,e,t){const n=`${le}/round`,a=Ae();let i={},o=[],{empty:f=!0}=e,c=0,d=!1;Pe(()=>{const s=()=>{a.scene.getMetadata().then(L),a.scene.items.getItems().then(P),a.scene.items.onChange(r=>P(r)),a.scene.onMetadataChange(L)};a.scene.onReadyChange(r=>{r&&s()}),a.scene.isReady().then(r=>{r&&s()})});function p(s){return ct(s,o.length)}function L(s){let r=s[n]??0;c!==r&&t(3,c=r)}function D(){t(2,o=Object.keys(i).sort((s,r)=>{const h=i[s],y=i[r];return h.initiative===y.initiative?s.localeCompare(r):y.initiative-h.initiative}))}function A(s,r){const h=i[r];h.entryElem=s}function E(s){const r=i[s];if(!d&&r.entryElem){const h=r.entryElem,y=h.parentElement,m=h.getBoundingClientRect(),b={top:y.scrollTop,bottom:y.scrollTop+y.scrollHeight,height:y.scrollHeight};(b.top>m.top||b.bottom<m.bottom)&&y.scrollTo(0,m.top)}}async function P(s){const r=s.filter(V=>V.metadata[de]),h=U(),y=o[h];t(1,i=Object.assign({},...r.map(V=>{var J,Q;return{[V.id]:{...i[V.id],initiative:Number((J=V.metadata[de])==null?void 0:J.count)??0,active:!!V.metadata[de].active,name:((Q=V.text)==null?void 0:Q.plainText)||V.name}}}))),D();let m=U();m===-1&&o.length&&(m=await z(h));const b=o[U()];b&&b!==y&&E(b)}async function z(s){return s=p(s),await a.scene.items.updateItems(o,r=>{for(const h of r){const y=h.metadata[de];y.active=h.id===o[s]}}),s}function U(){return o.findIndex(s=>i[s].active)}async function N(){if(o.length===0)return;const s=p(U());z(s+1),s===o.length-1&&t(3,++c)}async function S(){if(o.length===0)return;const s=p(U());z(s-1),s===0&&c>0&&t(3,--c)}async function $(s){const r=await a.scene.items.getItemBounds([s]);r.width===0||r.height===0||(r.min={x:r.center.x-r.width,y:r.center.y-r.height},r.max={x:r.center.x+r.width,y:r.center.y+r.height},r.height*=2,r.width*=2,await a.viewport.animateToBounds(r))}function R(s){const r=i[s];t(1,i[s].editContent=r.initiative.toString(),i)}function I(s){t(1,i[s].editContent=void 0,i)}function H(s){const r=i[s],h=Number(r.editContent||"0");if(!isNaN(h)){t(1,i[s].initiative=h,i),I(s),a.scene.items.updateItems([s],([y])=>{var b;const m=(b=y.metadata)==null?void 0:b[de];m&&Number(m.count)!==h&&(m.count=`${h}`)});return}}function g(s){i[s].editContent=qe(this.value),t(1,i)}function w(s,r){we[s?"unshift":"push"](()=>{i[r].editElem=s,t(1,i)})}const M=s=>H(s),K=(s,r)=>{r.code==="Escape"&&(r.preventDefault(),I(s))},G=s=>H(s),B=s=>R(s),Y=s=>$(s),X=()=>t(3,c=0),u=()=>S(),W=()=>N();return l.$$set=s=>{"empty"in s&&t(0,f=s.empty)},l.$$.update=()=>{l.$$.dirty[0]&5&&(t(0,f=o.length===0),f&&t(3,c=0)),l.$$.dirty[0]&8&&(async s=>{await a.scene.isReady()&&(await a.scene.getMetadata())[n]!==s&&await a.scene.setMetadata({[n]:s})})(c),l.$$.dirty[0]&2&&t(4,d=Object.values(i).some(s=>s.editContent!==void 0))},[f,i,o,c,d,A,N,S,$,R,I,H,g,w,M,K,G,B,Y,X,u,W]}class yt extends ve{constructor(e){super(),pe(this,e,wt,mt,he,{empty:0},null,[-1,-1])}}const bt=`uniform vec2 size;
uniform mat3 view;
uniform shader scene;
uniform float speed;
uniform float time;
uniform float amplitude;
uniform float spacing;

const float PI = 3.1415926;

float2 rippleUV(float2 uv) {
    uv = (uv / size) * 2 - 1;
    float uvl = length(uv);
    float t = (spacing / (1 + uvl) + time * speed) * 2 * PI;
    float o = sin(t) * amplitude;
    return ((uv + (uv / uvl * o)) / 2 + 0.5) * size;
}

half4 main(float2 coord) {
    float2 uv = (float3(coord, 1) * view).xy;
    return scene.eval(rippleUV(uv));
}`;function It(l,e,t){const n=`${le}/viewport-effect`,a=Ae(),i={},o=d=>!!i[d];async function f(d){i[d]=!1;const p=`${n}/${d}`;await a.scene.local.deleteItems([p])}async function c(d){const p=`${n}/${d}`,L=et().id(p).layer("POST_PROCESS").disableHit(!0).effectType("VIEWPORT").locked(!0);if(d==="ripple")L.sksl(bt).uniforms([{name:"speed",value:1.5},{name:"amplitude",value:.0175},{name:"spacing",value:5}]);else return;i[d]=!0,await a.scene.local.addItems([L.build()])}return Pe(()=>{a.broadcast.onMessage(le,d=>{if(!nt(d))return;const{data:p}=d;p.on?c(p.effect):f(p.effect)})}),[o]}class Et extends ve{constructor(e){super(),pe(this,e,It,null,he,{getEffectStatus:0})}get getEffectStatus(){return this.$$.ctx[0]}}function Le(l,e,t){const n=l.slice();return n[29]=e[t],n}function He(l,e,t){const n=l.slice();return n[32]=e[t],n[34]=t,n}function Ue(l,e,t){const n=l.slice();return n[32]=e[t],n[34]=t,n}function ze(l,e){let t,n,a,i;return n=new ot({props:{roll:e[32]}}),{key:l,first:null,c(){t=T("span"),ie(n.$$.fragment),a=j(),this.h()},l(o){t=C(o,"SPAN",{class:!0});var f=O(t);ae(n.$$.fragment,f),a=F(f),f.forEach(k),this.h()},h(){_(t,"class","formula svelte-1vgw67t"),this.first=t},m(o,f){ne(o,t,f),oe(n,t,null),v(t,a),i=!0},p(o,f){e=o;const c={};f[0]&2&&(c.roll=e[32]),n.$set(c)},i(o){i||(x(n.$$.fragment,o),i=!0)},o(o){ee(n.$$.fragment,o),i=!1},d(o){o&&k(t),ce(n)}}}function Be(l,e){let t,n=Ne(e[32])+"",a;return{key:l,first:null,c(){t=T("span"),a=se(n),this.h()},l(i){t=C(i,"SPAN",{class:!0});var o=O(t);a=re(o,n),o.forEach(k),this.h()},h(){_(t,"class","result svelte-1vgw67t"),this.first=t},m(i,o){ne(i,t,o),v(t,a)},p(i,o){e=i,o[0]&2&&n!==(n=Ne(e[32])+"")&&fe(a,n)},d(i){i&&k(t)}}}function We(l,e){var s;let t,n,a,i=new Date(e[29].when).toLocaleTimeString()+"",o,f,c,d,p=(((s=e[6][e[29].playerId])==null?void 0:s.name)??"?")+"",L,D,A,E,P=[],z=new Map,U,N,S,$=[],R=new Map,I,H,g="Reroll",w,M,K,G,B=ue(e[29].rolls);const Y=r=>r[34];for(let r=0;r<B.length;r+=1){let h=Ue(e,B,r),y=Y(h);z.set(y,P[r]=ze(y,h))}let X=ue(e[29].rolls);const u=r=>r[34];for(let r=0;r<X.length;r+=1){let h=He(e,X,r),y=u(h);R.set(y,$[r]=Be(y,h))}function W(){return e[13](e[29])}return{key:l,first:null,c(){t=T("div"),n=T("span"),a=T("span"),o=se(i),f=j(),c=T("span"),d=T("span"),L=se(p),D=se(":"),A=j(),E=T("span");for(let r=0;r<P.length;r+=1)P[r].c();U=j(),N=T("span"),S=se(`=
                        `);for(let r=0;r<$.length;r+=1)$[r].c();I=j(),H=T("a"),H.textContent=g,w=j(),this.h()},l(r){t=C(r,"DIV",{class:!0});var h=O(t);n=C(h,"SPAN",{class:!0});var y=O(n);a=C(y,"SPAN",{class:!0});var m=O(a);o=re(m,i),m.forEach(k),f=F(y),c=C(y,"SPAN",{class:!0});var b=O(c);d=C(b,"SPAN",{class:!0});var V=O(d);L=re(V,p),V.forEach(k),D=re(b,":"),b.forEach(k),A=F(y),E=C(y,"SPAN",{class:!0});var J=O(E);for(let Z=0;Z<P.length;Z+=1)P[Z].l(J);J.forEach(k),U=F(y),N=C(y,"SPAN",{class:!0});var Q=O(N);S=re(Q,`=
                        `);for(let Z=0;Z<$.length;Z+=1)$[Z].l(Q);Q.forEach(k),y.forEach(k),I=F(h),H=C(h,"A",{class:!0,href:!0,"data-svelte-h":!0}),_e(H)!=="svelte-1d304m4"&&(H.textContent=g),w=F(h),h.forEach(k),this.h()},h(){_(a,"class","timestamp svelte-1vgw67t"),_(d,"class","name svelte-1vgw67t"),_(c,"class","prefix svelte-1vgw67t"),_(E,"class","formulas svelte-1vgw67t"),_(N,"class","results svelte-1vgw67t"),_(n,"class","content svelte-1vgw67t"),_(H,"class","interaction svelte-1vgw67t"),_(H,"href","#"),_(t,"class","item svelte-1vgw67t"),q(t,"critical",e[29].rolls.some(e[14])),this.first=t},m(r,h){ne(r,t,h),v(t,n),v(n,a),v(a,o),v(n,f),v(n,c),v(c,d),v(d,L),v(c,D),v(n,A),v(n,E);for(let y=0;y<P.length;y+=1)P[y]&&P[y].m(E,null);v(n,U),v(n,N),v(N,S);for(let y=0;y<$.length;y+=1)$[y]&&$[y].m(N,null);v(t,I),v(t,H),v(t,w),M=!0,K||(G=te(H,"click",Ee(W)),K=!0)},p(r,h){var y;e=r,(!M||h[0]&2)&&i!==(i=new Date(e[29].when).toLocaleTimeString()+"")&&fe(o,i),(!M||h[0]&66)&&p!==(p=(((y=e[6][e[29].playerId])==null?void 0:y.name)??"?")+"")&&fe(L,p),h[0]&2&&(B=ue(e[29].rolls),Te(),P=Ie(P,h,Y,1,e,B,z,E,De,ze,null,Ue),Ce()),h[0]&2&&(X=ue(e[29].rolls),$=Ie($,h,u,1,e,X,R,N,xe,Be,null,He)),(!M||h[0]&2)&&q(t,"critical",e[29].rolls.some(e[14]))},i(r){if(!M){for(let h=0;h<B.length;h+=1)x(P[h]);M=!0}},o(r){for(let h=0;h<P.length;h+=1)ee(P[h]);M=!1},d(r){r&&k(t);for(let h=0;h<P.length;h+=1)P[h].d();for(let h=0;h<$.length;h+=1)$[h].d();K=!1,G()}}}function kt(l){let e,t,n,a,i,o,f="Rolls",c,d,p=[],L=new Map,D,A,E,P,z,U='<input tabindex="0" type="submit" title="Roll!" value="" class="svelte-1vgw67t"/>',N,S,$="Turns",R,I,H,g,w,M,K,G,B,Y,X;function u(m){l[12](m)}let W={};l[5]!==void 0&&(W.getEffectStatus=l[5]),t=new Et({props:W}),we.push(()=>Ve(t,"getEffectStatus",u));let s=ue(l[1]);const r=m=>m[29].rollId;for(let m=0;m<s.length;m+=1){let b=Le(l,s,m),V=r(b);L.set(V,p[m]=We(V,b))}function h(m){l[18](m)}let y={};return l[4]!==void 0&&(y.empty=l[4]),M=new yt({props:y}),we.push(()=>Ve(M,"empty",h)),{c(){e=T("div"),ie(t.$$.fragment),a=j(),i=T("div"),o=T("div"),o.textContent=f,c=j(),d=T("div");for(let m=0;m<p.length;m+=1)p[m].c();D=j(),A=T("form"),E=T("input"),P=j(),z=T("div"),z.innerHTML=U,N=j(),S=T("div"),S.textContent=$,R=j(),I=T("div"),H=T("div"),g=j(),w=T("div"),ie(M.$$.fragment),this.h()},l(m){e=C(m,"DIV",{class:!0});var b=O(e);ae(t.$$.fragment,b),a=F(b),i=C(b,"DIV",{class:!0});var V=O(i);o=C(V,"DIV",{class:!0,"data-svelte-h":!0}),_e(o)!=="svelte-10z2uja"&&(o.textContent=f),c=F(V),d=C(V,"DIV",{class:!0});var J=O(d);for(let ke=0;ke<p.length;ke+=1)p[ke].l(J);J.forEach(k),D=F(V),A=C(V,"FORM",{class:!0,action:!0});var Q=O(A);E=C(Q,"INPUT",{tabindex:!0,type:!0,placeholder:!0,class:!0}),P=F(Q),z=C(Q,"DIV",{class:!0,"data-svelte-h":!0}),_e(z)!=="svelte-xwrqxu"&&(z.innerHTML=U),Q.forEach(k),N=F(V),S=C(V,"DIV",{class:!0,"data-svelte-h":!0}),_e(S)!=="svelte-1ln1kl0"&&(S.textContent=$),R=F(V),I=C(V,"DIV",{class:!0});var Z=O(I);H=C(Z,"DIV",{class:!0}),O(H).forEach(k),g=F(Z),w=C(Z,"DIV",{class:!0});var Se=O(w);ae(M.$$.fragment,Se),Se.forEach(k),Z.forEach(k),V.forEach(k),b.forEach(k),this.h()},h(){_(o,"class","rolls-header header svelte-1vgw67t"),_(d,"class","roll-history svelte-1vgw67t"),_(E,"tabindex","0"),_(E,"type","text"),_(E,"placeholder","d20 (🢁 or 🢃 for history)"),_(E,"class","svelte-1vgw67t"),_(z,"class","submit-container svelte-1vgw67t"),q(z,"validated",l[8](l[3])),_(A,"class","roll-input svelte-1vgw67t"),_(A,"action","#"),_(S,"class","initiative-header header svelte-1vgw67t"),_(H,"class","separator svelte-1vgw67t"),_(w,"class","graph svelte-1vgw67t"),_(I,"class","initiative svelte-1vgw67t"),_(i,"class","grid svelte-1vgw67t"),Ze(()=>l[19].call(i)),q(i,"no-initiative",l[4]),_(e,"class","component svelte-1vgw67t"),q(e,"dev",Xe(Ke))},m(m,b){ne(m,e,b),oe(t,e,null),v(e,a),v(e,i),v(i,o),v(i,c),v(i,d);for(let V=0;V<p.length;V+=1)p[V]&&p[V].m(d,null);l[15](d),v(i,D),v(i,A),v(A,E),ye(E,l[3]),v(A,P),v(A,z),v(i,N),v(i,S),v(i,R),v(i,I),v(I,H),v(I,g),v(I,w),oe(M,w,null),G=Qe(i,l[19].bind(i)),B=!0,Y||(X=[te(E,"input",l[16]),te(E,"keydown",l[10]),te(A,"submit",Ee(l[17]))],Y=!0)},p(m,b){const V={};!n&&b[0]&32&&(n=!0,V.getEffectStatus=m[5],Re(()=>n=!1)),t.$set(V),b[0]&2114&&(s=ue(m[1]),Te(),p=Ie(p,b,r,1,m,s,L,d,De,We,null,Le),Ce()),b[0]&8&&E.value!==m[3]&&ye(E,m[3]),(!B||b[0]&264)&&q(z,"validated",m[8](m[3]));const J={};!K&&b[0]&16&&(K=!0,J.empty=m[4],Re(()=>K=!1)),M.$set(J),(!B||b[0]&16)&&q(i,"no-initiative",m[4])},i(m){if(!B){x(t.$$.fragment,m);for(let b=0;b<s.length;b+=1)x(p[b]);x(M.$$.fragment,m),B=!0}},o(m){ee(t.$$.fragment,m);for(let b=0;b<p.length;b+=1)ee(p[b]);ee(M.$$.fragment,m),B=!1},d(m){m&&k(e),ce(t);for(let b=0;b<p.length;b+=1)p[b].d();l[15](null),ce(M),G(),Y=!1,Fe(X)}}}const Pt=16;function Tt(l){return!!l.rolls}function Ct(l){return typeof l.message=="string"}function Dt(l){return typeof l.cmd=="string"}function At(l,e,t){let n;const a=Ae(),i=tt();Je(l,i,u=>t(6,n=u));let o=[],f,c=[""],d="",p=0,L=!0,D;function A(u){try{if(z(u))return!0}catch{}return!1}function E(u){if(!u)return;const W=c.indexOf(u);W===-1?(c.push(u),c.splice(1,Math.max(0,c.length-Pt))):c.push(...c.splice(W,1))}function P(u){let W=c.lastIndexOf(d??"");W===-1&&(W=0,c[W]=d??"");let s=(W+u)%c.length;return s<0&&(s=c.length+s),t(3,d=c[s])}function z(u){if(u.startsWith("!"))return u.length===1?null:{message:u.substring(1)};if(u.startsWith("/")){const s=u.slice(1).split(/\s+/);return{cmd:s[0].trimEnd(),args:s.slice(1)}}const W=lt(u).map(s=>Me(s));return W.length?{rolls:W}:null}function U(){try{const u=z(d||"d20");if(!u)return;if(Ct(u))a.broadcast.sendMessage(le,{topic:"announce",msg:u.message,playerId:a.player.id},{destination:"ALL"});else if(Tt(u))S(u.rolls);else if(Dt(u))if(u.cmd==="effect"){if(u.args.length<1)throw new Error("Invalid effect");N(u.args[0],...u.args.slice(1))}else Xe(Ke)&&u.cmd==="crit"&&$()}catch(u){if(u instanceof it){a.notification.show(u.message,"ERROR");return}return}E(d),t(3,d=""),H()}function N(u,...W){a.broadcast.sendMessage(le,{topic:"effect",effect:u,on:!D(u)},{destination:"ALL"})}function S(u){a.broadcast.sendMessage(le,{topic:"roll",rolls:u,rollId:crypto.randomUUID(),playerId:a.player.id,when:Date.now()},{destination:"ALL"})}async function $(){a.broadcast.sendMessage(le,{topic:"roll",rolls:[{sides:20,results:[20]}],rollId:crypto.randomUUID(),playerId:a.player.id,when:Date.now()},{destination:"ALL"})}function R(u){u.key==="ArrowUp"?(P(-1),u.preventDefault()):u.key==="ArrowDown"?(P(1),u.preventDefault()):u.key==="Escape"&&(t(3,d=""),u.preventDefault())}async function I(u){S(u.rolls.map(W=>Me(st(W)))),setTimeout(H,100)}function H(){t(2,f.scrollTop=f.scrollHeight,f)}Pe(()=>{a.broadcast.onMessage(le,async u=>{if(!at(u)||!f)return;o.push({playerId:u.data.playerId,rolls:u.data.rolls,rollId:u.data.rollId,when:u.data.when}),t(1,o=o.slice(-100)),Math.ceil(f.scrollTop)>=Math.floor(f.scrollHeight-f.clientHeight)-16&&setTimeout(H,10)})});function g(u){D=u,t(5,D)}const w=u=>I(u),M=u=>rt(u);function K(u){we[u?"unshift":"push"](()=>{f=u,t(2,f)})}function G(){d=this.value,t(3,d)}const B=()=>U();function Y(u){L=u,t(4,L)}function X(){p=this.offsetWidth,t(0,p)}return l.$$.update=()=>{l.$$.dirty[0]&1&&p&&p!==window.window.innerWidth&&a.action.setWidth(p)},[p,o,f,d,L,D,n,i,A,U,R,I,g,w,M,K,G,B,Y,X]}class Ot extends ve{constructor(e){super(),pe(this,e,At,kt,he,{},null,[-1,-1])}}export{Ot as component};
