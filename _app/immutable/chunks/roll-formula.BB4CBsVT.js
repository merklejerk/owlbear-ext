import{s as Ur,n as Ye}from"./scheduler.BXvgzZK-.js";import{S as zr,i as Vr,e as O,b as $,c as L,d as P,f as U,g as S,r as b,z as ue,j as k,k as w,l as ae,u as Ze,t as F,a as C,x as Ee,v as Fe,s as _e,h as Se,G as Dt,m as ze,n as Ve,o as Ke,p as He}from"./index.BQ0Ppj1p.js";import{e as Le}from"./public.DaMEbo7N.js";function ma(t){var e;return((e=t.data)==null?void 0:e.topic)==="roll"}function da(t){var e;return((e=t.data)==null?void 0:e.topic)==="announce"}function ga(t){var e;return((e=t.data)==null?void 0:e.topic)==="effect"}function j(t){const e=t||"";return function(){throw new Error("this method "+e+" is abstract! (it has no implementation in class "+this.constructor.name+")")}}function ve(t,e){if(!t)throw new Error(e||"Assertion failed")}function yt(t,e,r){let n;Object.defineProperty(t,e,{get(){return n||(n=r.call(this)),n}})}function mi(t){return t&&Object.assign({},t)}function Kr(t,e){const r=[];for(;e-- >0;)r.push(t());return r}function Hr(t,e){return new Array(e+1).join(t)}function st(t,e){return Kr(()=>t,e)}function _t(t){const e=[];for(let r=0;r<t.length;r++){const n=t[r];t.lastIndexOf(n)!==r&&e.indexOf(n)<0&&e.push(n)}return e}function Wr(t){const e=[];return t.forEach(r=>{e.indexOf(r)<0&&e.push(r)}),e}function ye(t){const e=t[0];return e===e.toUpperCase()}function Jr(t){return!ye(t)}function Xr(t,e,r){const n=r||" ";return t.length<e?Hr(n,e-t.length)+t:t}function we(){this.strings=[]}we.prototype.append=function(t){this.strings.push(t)};we.prototype.contents=function(){return this.strings.join("")};const ft=t=>String.fromCodePoint(parseInt(t,16));function jr(t){if(t.charAt(0)==="\\")switch(t.charAt(1)){case"b":return"\b";case"f":return"\f";case"n":return`
`;case"r":return"\r";case"t":return"	";case"v":return"\v";case"x":return ft(t.slice(2,4));case"u":return t.charAt(2)==="{"?ft(t.slice(3,-1)):ft(t.slice(2,6));default:return t.charAt(1)}else return t}function Qr(t){if(t==null)return String(t);const e=Object.prototype.toString.call(t);try{let r;return t.constructor&&t.constructor.name?r=t.constructor.name:e.indexOf("[object ")===0?r=e.slice(8,-1):r=typeof t,r+": "+JSON.stringify(String(t))}catch{return e}}const di=Object.freeze(Object.defineProperty({__proto__:null,StringBuffer:we,abstract:j,assert:ve,clone:mi,copyWithoutDuplicates:Wr,defineLazyProperty:yt,getDuplicates:_t,isLexical:Jr,isSyntactic:ye,padLeft:Xr,repeat:st,repeatFn:Kr,repeatStr:Hr,unescapeCodePoint:jr,unexpectedObjToString:Qr},Symbol.toStringTag,{value:"Module"})),gi={Lu:new RegExp("\\p{Lu}","u"),Ll:new RegExp("\\p{Ll}","u"),Lt:new RegExp("\\p{Lt}","u"),Lm:new RegExp("\\p{Lm}","u"),Lo:new RegExp("\\p{Lo}","u"),Nl:new RegExp("\\p{Nl}","u"),Nd:new RegExp("\\p{Nd}","u"),Mn:new RegExp("\\p{Mn}","u"),Mc:new RegExp("\\p{Mc}","u"),Pc:new RegExp("\\p{Pc}","u"),Zs:new RegExp("\\p{Zs}","u"),L:new RegExp("\\p{Letter}","u"),Ltmo:new RegExp("\\p{Lt}|\\p{Lm}|\\p{Lo}","u")};class I{constructor(){if(this.constructor===I)throw new Error("PExpr cannot be instantiated -- it's abstract")}withSource(e){return e&&(this.source=e.trimmed()),this}}const z=Object.create(I.prototype),V=Object.create(I.prototype);class G extends I{constructor(e){super(),this.obj=e}}class K extends I{constructor(e,r){super(),this.from=e,this.to=r,this.matchCodePoint=e.length>1||r.length>1}}class H extends I{constructor(e){super(),this.index=e}}class D extends I{constructor(e){super(),this.terms=e}}class ot extends D{constructor(e,r,n){const i=e.rules[r].body;super([n,i]),this.superGrammar=e,this.name=r,this.body=n}}class at extends D{constructor(e,r,n,i){const s=e.rules[r].body;super([...n,s,...i]),this.superGrammar=e,this.ruleName=r,this.expansionPos=n.length}}class T extends I{constructor(e){super(),this.factors=e}}class Q extends I{constructor(e){super(),this.expr=e}}class xe extends Q{}class De extends Q{}class fe extends Q{}xe.prototype.operator="*";De.prototype.operator="+";fe.prototype.operator="?";xe.prototype.minNumMatches=0;De.prototype.minNumMatches=1;fe.prototype.minNumMatches=0;xe.prototype.maxNumMatches=Number.POSITIVE_INFINITY;De.prototype.maxNumMatches=Number.POSITIVE_INFINITY;fe.prototype.maxNumMatches=1;class Y extends I{constructor(e){super(),this.expr=e}}class Z extends I{constructor(e){super(),this.expr=e}}class ne extends I{constructor(e){super(),this.expr=e}}class x extends I{constructor(e,r=[]){super(),this.ruleName=e,this.args=r}isSyntactic(){return ye(this.ruleName)}toMemoKey(){return this._memoKey||Object.defineProperty(this,"_memoKey",{value:this.toString()}),this._memoKey}}class B extends I{constructor(e){super(),this.category=e,this.pattern=gi[e]}}function E(t,e){let r;return e?(r=new Error(e.getLineAndColumnMessage()+t),r.shortMessage=t,r.interval=e):r=new Error(t),r}function St(){return E("Interval sources don't match")}function vi(t,e,r){const n=e?`Grammar ${t} is not declared in namespace '${e}'`:"Undeclared grammar "+t;return E(n,r)}function Ii(t,e){return E("Grammar "+t.name+" is already declared in this namespace")}function yi(t){return E(`Grammar '${t.name}' does not support incremental parsing`)}function Yr(t,e,r){return E("Rule "+t+" is not declared in grammar "+e,r)}function _i(t,e,r){return E("Cannot override rule "+t+" because it is not declared in "+e,r)}function Si(t,e,r){return E("Cannot extend rule "+t+" because it is not declared in "+e,r)}function ir(t,e,r,n){let i="Duplicate declaration for rule '"+t+"' in grammar '"+e+"'";return e!==r&&(i+=" (originally declared in '"+r+"')"),E(i,n)}function Zr(t,e,r,n){return E("Wrong number of parameters for rule "+t+" (expected "+e+", got "+r+")",n)}function Ai(t,e,r,n){return E("Wrong number of arguments for rule "+t+" (expected "+e+", got "+r+")",n)}function sr(t,e,r){return E("Duplicate parameter names in rule "+t+": "+e.join(", "),r)}function wi(t,e){return E("Invalid parameter to rule "+t+": "+e+" has arity "+e.getArity()+", but parameter expressions must have arity 1",e.source)}const xi="NOTE: A _syntactic rule_ is a rule whose name begins with a capital letter. See https://ohmjs.org/d/svl for more details.";function Ni(t,e){return E("Cannot apply syntactic rule "+t+" from here (inside a lexical context)",e.source)}function Ri(t){const{ruleName:e}=t;return E(`applySyntactic is for syntactic rules, but '${e}' is a lexical rule. `+xi,t.source)}function bi(t){return E("applySyntactic is not required here (in a syntactic context)",t.source)}function or(t,e){return E("Incorrect argument type: expected "+t,e.source)}function Oi(t){return E("'...' can appear at most once in a rule body",t.source)}function Li(t){const e=t._node;ve(e&&e.isNonterminal()&&e.ctorName==="escapeChar_unicodeCodePoint");const r=t.children.slice(1,-1).map(i=>i.source),n=r[0].coverageWith(...r.slice(1));return E(`U+${n.contents} is not a valid Unicode code point`,n)}function en(t,e){const r=e.length>0?e[e.length-1].args:[];let i="Nullable expression "+t.expr.substituteParams(r)+" is not allowed inside '"+t.operator+"' (possible infinite loop)";if(e.length>0){const s=e.map(o=>new x(o.ruleName,o.args)).join(`
`);i+=`
Application stack (most recent application last):
`+s}return E(i,t.expr.source)}function tn(t,e,r,n){return E("Rule "+t+" involves an alternation which has inconsistent arity (expected "+e+", got "+r+")",n.source)}function Pi(t){const e=t.map(r=>r.message);return E(["Errors:"].concat(e).join(`
- `),t[0].interval)}function Ei(t,e,r,n){let i=n.slice(0,-1).map(l=>{const p="  "+l[0].name+" > "+l[1];return l.length===3?p+" for '"+l[2]+"'":p}).join(`
`);i+=`
  `+e+" > "+t;let s="";t==="_iter"&&(s=[`
NOTE: as of Ohm v16, there is no default action for iteration nodes — see `,"  https://ohmjs.org/d/dsa for details."].join(`
`));const o=[`Missing semantic action for '${t}' in ${r} '${e}'.${s}`,"Action stack (most recent call last):",i].join(`
`),a=E(o);return a.name="missingSemanticAction",a}function Fi(t){if(t.length===1)throw t[0];if(t.length>1)throw Pi(t)}function Di(t){let e=0;return t.map(n=>{const i=n.toString();return e=Math.max(e,i.length),i}).map(n=>Xr(n,e))}function ar(t,e,r){const n=t.length,i=t.slice(0,r),s=t.slice(r+e.length);return(i+e+s).substr(0,n)}function Ci(...t){const e=this,{offset:r}=e,{repeatStr:n}=di,i=new we;i.append("Line "+e.lineNum+", col "+e.colNum+`:
`);const s=Di([e.prevLine==null?0:e.lineNum-1,e.lineNum,e.nextLine==null?0:e.lineNum+1]),o=(c,u,h)=>{i.append(h+s[c]+" | "+u+`
`)};e.prevLine!=null&&o(0,e.prevLine,"  "),o(1,e.line,"> ");const a=e.line.length;let l=n(" ",a+1);for(let c=0;c<t.length;++c){let u=t[c][0],h=t[c][1];ve(u>=0&&u<=h,"range start must be >= 0 and <= end");const m=r-e.colNum+1;u=Math.max(0,u-m),h=Math.min(h-m,a),l=ar(l,n("~",h-u),u)}const p=2+s[1].length+3;return i.append(n(" ",p)),l=ar(l,"^",e.colNum-1),i.append(l.replace(/ +$/,"")+`
`),e.nextLine!=null&&o(2,e.nextLine,"  "),i.contents()}let At=[];function rn(t){At.push(t)}function Ti(t){At.forEach(e=>{e(t)}),At=null}function Ct(t,e){let r=1,n=1,i=0,s=0,o=null,a=null,l=-1;for(;i<e;){const u=t.charAt(i++);u===`
`?(r++,n=1,l=s,s=i):u!=="\r"&&n++}let p=t.indexOf(`
`,s);if(p===-1)p=t.length;else{const u=t.indexOf(`
`,p+1);o=u===-1?t.slice(p):t.slice(p,u),o=o.replace(/^\r?\n/,"").replace(/\r$/,"")}l>=0&&(a=t.slice(l,s).replace(/\r?\n$/,""));const c=t.slice(s,p).replace(/\r$/,"");return{offset:e,lineNum:r,colNum:n,line:c,prevLine:a,nextLine:o,toString:Ci}}function nn(t,e,...r){return Ct(t,e).toString(...r)}const lr=(()=>{let t=0;return e=>""+e+t++})();class q{constructor(e,r,n){this.sourceString=e,this.startIdx=r,this.endIdx=n}get contents(){return this._contents===void 0&&(this._contents=this.sourceString.slice(this.startIdx,this.endIdx)),this._contents}get length(){return this.endIdx-this.startIdx}coverageWith(...e){return q.coverage(...e,this)}collapsedLeft(){return new q(this.sourceString,this.startIdx,this.startIdx)}collapsedRight(){return new q(this.sourceString,this.endIdx,this.endIdx)}getLineAndColumn(){return Ct(this.sourceString,this.startIdx)}getLineAndColumnMessage(){const e=[this.startIdx,this.endIdx];return nn(this.sourceString,this.startIdx,e)}minus(e){if(this.sourceString!==e.sourceString)throw St();return this.startIdx===e.startIdx&&this.endIdx===e.endIdx?[]:this.startIdx<e.startIdx&&e.endIdx<this.endIdx?[new q(this.sourceString,this.startIdx,e.startIdx),new q(this.sourceString,e.endIdx,this.endIdx)]:this.startIdx<e.endIdx&&e.endIdx<this.endIdx?[new q(this.sourceString,e.endIdx,this.endIdx)]:this.startIdx<e.startIdx&&e.startIdx<this.endIdx?[new q(this.sourceString,this.startIdx,e.startIdx)]:[this]}relativeTo(e){if(this.sourceString!==e.sourceString)throw St();return ve(this.startIdx>=e.startIdx&&this.endIdx<=e.endIdx,"other interval does not cover this one"),new q(this.sourceString,this.startIdx-e.startIdx,this.endIdx-e.startIdx)}trimmed(){const{contents:e}=this,r=this.startIdx+e.match(/^\s*/)[0].length,n=this.endIdx-e.match(/\s*$/)[0].length;return new q(this.sourceString,r,n)}subInterval(e,r){const n=this.startIdx+e;return new q(this.sourceString,n,n+r)}}q.coverage=function(t,...e){let{startIdx:r,endIdx:n}=t;for(const i of e){if(i.sourceString!==t.sourceString)throw St();r=Math.min(r,i.startIdx),n=Math.max(n,i.endIdx)}return new q(t.sourceString,r,n)};const Mi=65535;class lt{constructor(e){this.source=e,this.pos=0,this.examinedLength=0}atEnd(){const e=this.pos>=this.source.length;return this.examinedLength=Math.max(this.examinedLength,this.pos+1),e}next(){const e=this.source[this.pos++];return this.examinedLength=Math.max(this.examinedLength,this.pos),e}nextCharCode(){const e=this.next();return e&&e.charCodeAt(0)}nextCodePoint(){const e=this.source.slice(this.pos++).codePointAt(0);return e>Mi&&(this.pos+=1),this.examinedLength=Math.max(this.examinedLength,this.pos),e}matchString(e,r){let n;if(r){for(n=0;n<e.length;n++){const i=this.next(),s=e[n];if(i==null||i.toUpperCase()!==s.toUpperCase())return!1}return!0}for(n=0;n<e.length;n++)if(this.next()!==e[n])return!1;return!0}sourceSlice(e,r){return this.source.slice(e,r)}interval(e,r){return new q(this.source,e,r||this.pos)}}class sn{constructor(e,r,n,i,s,o,a){this.matcher=e,this.input=r,this.startExpr=n,this._cst=i,this._cstOffset=s,this._rightmostFailurePosition=o,this._rightmostFailures=a,this.failed()&&(yt(this,"message",function(){const l="Expected "+this.getExpectedText();return nn(this.input,this.getRightmostFailurePosition())+l}),yt(this,"shortMessage",function(){const l="expected "+this.getExpectedText(),p=Ct(this.input,this.getRightmostFailurePosition());return"Line "+p.lineNum+", col "+p.colNum+": "+l}))}succeeded(){return!!this._cst}failed(){return!this.succeeded()}getRightmostFailurePosition(){return this._rightmostFailurePosition}getRightmostFailures(){if(!this._rightmostFailures){this.matcher.setInput(this.input);const e=this.matcher._match(this.startExpr,{tracing:!1,positionToRecordFailures:this.getRightmostFailurePosition()});this._rightmostFailures=e.getRightmostFailures()}return this._rightmostFailures}toString(){return this.succeeded()?"[match succeeded]":"[match failed at position "+this.getRightmostFailurePosition()+"]"}getExpectedText(){if(this.succeeded())throw new Error("cannot get expected text of a successful MatchResult");const e=new we;let r=this.getRightmostFailures();r=r.filter(n=>!n.isFluffy());for(let n=0;n<r.length;n++)n>0&&(n===r.length-1?e.append(r.length>2?", or ":" or "):e.append(", ")),e.append(r[n].toString());return e.contents()}getInterval(){const e=this.getRightmostFailurePosition();return new q(this.input,e,e)}}class ki{constructor(){this.applicationMemoKeyStack=[],this.memo={},this.maxExaminedLength=0,this.maxRightmostFailureOffset=-1,this.currentLeftRecursion=void 0}isActive(e){return this.applicationMemoKeyStack.indexOf(e.toMemoKey())>=0}enter(e){this.applicationMemoKeyStack.push(e.toMemoKey())}exit(){this.applicationMemoKeyStack.pop()}startLeftRecursion(e,r){r.isLeftRecursion=!0,r.headApplication=e,r.nextLeftRecursion=this.currentLeftRecursion,this.currentLeftRecursion=r;const{applicationMemoKeyStack:n}=this,i=n.indexOf(e.toMemoKey())+1,s=n.slice(i);r.isInvolved=function(o){return s.indexOf(o)>=0},r.updateInvolvedApplicationMemoKeys=function(){for(let o=i;o<n.length;o++){const a=n[o];this.isInvolved(a)||s.push(a)}}}endLeftRecursion(){this.currentLeftRecursion=this.currentLeftRecursion.nextLeftRecursion}shouldUseMemoizedResult(e){if(!e.isLeftRecursion)return!0;const{applicationMemoKeyStack:r}=this;for(let n=0;n<r.length;n++){const i=r[n];if(e.isInvolved(i))return!1}return!0}memoize(e,r){return this.memo[e]=r,this.maxExaminedLength=Math.max(this.maxExaminedLength,r.examinedLength),this.maxRightmostFailureOffset=Math.max(this.maxRightmostFailureOffset,r.rightmostFailureOffset),r}clearObsoleteEntries(e,r){if(e+this.maxExaminedLength<=r)return;const{memo:n}=this;this.maxExaminedLength=0,this.maxRightmostFailureOffset=-1,Object.keys(n).forEach(i=>{const s=n[i];e+s.examinedLength>r?delete n[i]:(this.maxExaminedLength=Math.max(this.maxExaminedLength,s.examinedLength),this.maxRightmostFailureOffset=Math.max(this.maxRightmostFailureOffset,s.rightmostFailureOffset))})}}const Bi="✗",Gi="✓",qi="⋅",$i="⇒",Ui="␉",zi="␊",Vi="␍",wt={succeeded:1,isRootNode:2,isImplicitSpaces:4,isMemoized:8,isHeadOfLeftRecursion:16,terminatesLR:32};function Ki(t){return st(" ",t).join("")}function Hi(t,e,r){const n=on(t.slice(e,e+r));return n.length<r?n+st(" ",r-n.length).join(""):n}function on(t){return typeof t=="string"?t.replace(/ /g,qi).replace(/\t/g,Ui).replace(/\n/g,zi).replace(/\r/g,Vi):String(t)}class ge{constructor(e,r,n,i,s,o,a){this.input=e,this.pos=this.pos1=r,this.pos2=n,this.source=new q(e,r,n),this.expr=i,this.bindings=o,this.children=a||[],this.terminatingLREntry=null,this._flags=s?wt.succeeded:0}get displayString(){return this.expr.toDisplayString()}clone(){return this.cloneWithExpr(this.expr)}cloneWithExpr(e){const r=new ge(this.input,this.pos,this.pos2,e,this.succeeded,this.bindings,this.children);return r.isHeadOfLeftRecursion=this.isHeadOfLeftRecursion,r.isImplicitSpaces=this.isImplicitSpaces,r.isMemoized=this.isMemoized,r.isRootNode=this.isRootNode,r.terminatesLR=this.terminatesLR,r.terminatingLREntry=this.terminatingLREntry,r}recordLRTermination(e,r){this.terminatingLREntry=new ge(this.input,this.pos,this.pos2,this.expr,!1,[r],[e]),this.terminatingLREntry.terminatesLR=!0}walk(e,r){let n=e;typeof n=="function"&&(n={enter:n});function i(s,o,a){let l=!0;n.enter&&n.enter.call(r,s,o,a)===ge.prototype.SKIP&&(l=!1),l&&(s.children.forEach(p=>{i(p,s,a+1)}),n.exit&&n.exit.call(r,s,o,a))}this.isRootNode?this.children.forEach(s=>{i(s,null,0)}):i(this,null,0)}toString(){const e=new we;return this.walk((r,n,i)=>{if(!r)return this.SKIP;if(r.expr.constructor.name!=="Alt"){if(e.append(Hi(r.input,r.pos,10)+Ki(i*2+1)),e.append((r.succeeded?Gi:Bi)+" "+r.displayString),r.isHeadOfLeftRecursion&&e.append(" (LR)"),r.succeeded){const o=on(r.source.contents);e.append(" "+$i+"  "),e.append(typeof o=="string"?'"'+o+'"':o)}e.append(`
`)}}),e.contents()}}ge.prototype.SKIP={};Object.keys(wt).forEach(t=>{const e=wt[t];Object.defineProperty(ge.prototype,t,{get(){return(this._flags&e)!==0},set(r){r?this._flags|=e:this._flags&=~e}})});I.prototype.allowsSkippingPrecedingSpace=j("allowsSkippingPrecedingSpace");z.allowsSkippingPrecedingSpace=V.allowsSkippingPrecedingSpace=x.prototype.allowsSkippingPrecedingSpace=G.prototype.allowsSkippingPrecedingSpace=K.prototype.allowsSkippingPrecedingSpace=B.prototype.allowsSkippingPrecedingSpace=function(){return!0};D.prototype.allowsSkippingPrecedingSpace=Q.prototype.allowsSkippingPrecedingSpace=ne.prototype.allowsSkippingPrecedingSpace=Z.prototype.allowsSkippingPrecedingSpace=Y.prototype.allowsSkippingPrecedingSpace=H.prototype.allowsSkippingPrecedingSpace=T.prototype.allowsSkippingPrecedingSpace=function(){return!1};let ke;rn(t=>{ke=t});let et;I.prototype.assertAllApplicationsAreValid=function(t,e){et=0,this._assertAllApplicationsAreValid(t,e)};I.prototype._assertAllApplicationsAreValid=j("_assertAllApplicationsAreValid");z._assertAllApplicationsAreValid=V._assertAllApplicationsAreValid=G.prototype._assertAllApplicationsAreValid=K.prototype._assertAllApplicationsAreValid=H.prototype._assertAllApplicationsAreValid=B.prototype._assertAllApplicationsAreValid=function(t,e){};ne.prototype._assertAllApplicationsAreValid=function(t,e){et++,this.expr._assertAllApplicationsAreValid(t,e),et--};D.prototype._assertAllApplicationsAreValid=function(t,e){for(let r=0;r<this.terms.length;r++)this.terms[r]._assertAllApplicationsAreValid(t,e)};T.prototype._assertAllApplicationsAreValid=function(t,e){for(let r=0;r<this.factors.length;r++)this.factors[r]._assertAllApplicationsAreValid(t,e)};Q.prototype._assertAllApplicationsAreValid=Y.prototype._assertAllApplicationsAreValid=Z.prototype._assertAllApplicationsAreValid=function(t,e){this.expr._assertAllApplicationsAreValid(t,e)};x.prototype._assertAllApplicationsAreValid=function(t,e,r=!1){const n=e.rules[this.ruleName],i=ye(t)&&et===0;if(!n)throw Yr(this.ruleName,e.name,this.source);if(!r&&ye(this.ruleName)&&!i)throw Ni(this.ruleName,this);const s=this.args.length,o=n.formals.length;if(s!==o)throw Ai(this.ruleName,o,s,this.source);const a=ke&&n===ke.rules.applySyntactic;if(ke&&n===ke.rules.caseInsensitive&&!(this.args[0]instanceof G))throw or('a Terminal (e.g. "abc")',this.args[0]);if(a){const p=this.args[0];if(!(p instanceof x))throw or("a syntactic rule application",p);if(!ye(p.ruleName))throw Ri(p);if(i)throw bi(this)}this.args.forEach(p=>{if(p._assertAllApplicationsAreValid(t,e,a),p.getArity()!==1)throw wi(this.ruleName,p)})};I.prototype.assertChoicesHaveUniformArity=j("assertChoicesHaveUniformArity");z.assertChoicesHaveUniformArity=V.assertChoicesHaveUniformArity=G.prototype.assertChoicesHaveUniformArity=K.prototype.assertChoicesHaveUniformArity=H.prototype.assertChoicesHaveUniformArity=ne.prototype.assertChoicesHaveUniformArity=B.prototype.assertChoicesHaveUniformArity=function(t){};D.prototype.assertChoicesHaveUniformArity=function(t){if(this.terms.length===0)return;const e=this.terms[0].getArity();for(let r=0;r<this.terms.length;r++){const n=this.terms[r];n.assertChoicesHaveUniformArity();const i=n.getArity();if(e!==i)throw tn(t,e,i,n)}};ot.prototype.assertChoicesHaveUniformArity=function(t){const e=this.terms[0].getArity(),r=this.terms[1].getArity();if(e!==r)throw tn(t,r,e,this.terms[0])};T.prototype.assertChoicesHaveUniformArity=function(t){for(let e=0;e<this.factors.length;e++)this.factors[e].assertChoicesHaveUniformArity(t)};Q.prototype.assertChoicesHaveUniformArity=function(t){this.expr.assertChoicesHaveUniformArity(t)};Y.prototype.assertChoicesHaveUniformArity=function(t){};Z.prototype.assertChoicesHaveUniformArity=function(t){this.expr.assertChoicesHaveUniformArity(t)};x.prototype.assertChoicesHaveUniformArity=function(t){};I.prototype.assertIteratedExprsAreNotNullable=j("assertIteratedExprsAreNotNullable");z.assertIteratedExprsAreNotNullable=V.assertIteratedExprsAreNotNullable=G.prototype.assertIteratedExprsAreNotNullable=K.prototype.assertIteratedExprsAreNotNullable=H.prototype.assertIteratedExprsAreNotNullable=B.prototype.assertIteratedExprsAreNotNullable=function(t){};D.prototype.assertIteratedExprsAreNotNullable=function(t){for(let e=0;e<this.terms.length;e++)this.terms[e].assertIteratedExprsAreNotNullable(t)};T.prototype.assertIteratedExprsAreNotNullable=function(t){for(let e=0;e<this.factors.length;e++)this.factors[e].assertIteratedExprsAreNotNullable(t)};Q.prototype.assertIteratedExprsAreNotNullable=function(t){if(this.expr.assertIteratedExprsAreNotNullable(t),this.expr.isNullable(t))throw en(this,[])};fe.prototype.assertIteratedExprsAreNotNullable=Y.prototype.assertIteratedExprsAreNotNullable=Z.prototype.assertIteratedExprsAreNotNullable=ne.prototype.assertIteratedExprsAreNotNullable=function(t){this.expr.assertIteratedExprsAreNotNullable(t)};x.prototype.assertIteratedExprsAreNotNullable=function(t){this.args.forEach(e=>{e.assertIteratedExprsAreNotNullable(t)})};class Tt{constructor(e){this.matchLength=e}get ctorName(){throw new Error("subclass responsibility")}numChildren(){return this.children?this.children.length:0}childAt(e){if(this.children)return this.children[e]}indexOfChild(e){return this.children.indexOf(e)}hasChildren(){return this.numChildren()>0}hasNoChildren(){return!this.hasChildren()}onlyChild(){if(this.numChildren()!==1)throw new Error("cannot get only child of a node of type "+this.ctorName+" (it has "+this.numChildren()+" children)");return this.firstChild()}firstChild(){if(this.hasNoChildren())throw new Error("cannot get first child of a "+this.ctorName+" node, which has no children");return this.childAt(0)}lastChild(){if(this.hasNoChildren())throw new Error("cannot get last child of a "+this.ctorName+" node, which has no children");return this.childAt(this.numChildren()-1)}childBefore(e){const r=this.indexOfChild(e);if(r<0)throw new Error("Node.childBefore() called w/ an argument that is not a child");if(r===0)throw new Error("cannot get child before first child");return this.childAt(r-1)}childAfter(e){const r=this.indexOfChild(e);if(r<0)throw new Error("Node.childAfter() called w/ an argument that is not a child");if(r===this.numChildren()-1)throw new Error("cannot get child after last child");return this.childAt(r+1)}isTerminal(){return!1}isNonterminal(){return!1}isIteration(){return!1}isOptional(){return!1}}class Ne extends Tt{get ctorName(){return"_terminal"}isTerminal(){return!0}get primitiveValue(){throw new Error("The `primitiveValue` property was removed in Ohm v17.")}}class Wi extends Tt{constructor(e,r,n,i){super(i),this.ruleName=e,this.children=r,this.childOffsets=n}get ctorName(){return this.ruleName}isNonterminal(){return!0}isLexical(){return Jr(this.ctorName)}isSyntactic(){return ye(this.ctorName)}}class an extends Tt{constructor(e,r,n,i){super(n),this.children=e,this.childOffsets=r,this.optional=i}get ctorName(){return"_iter"}isIteration(){return!0}isOptional(){return this.optional}}I.prototype.eval=j("eval");z.eval=function(t){const{inputStream:e}=t,r=e.pos,n=e.nextCodePoint();return n!==void 0?(t.pushBinding(new Ne(String.fromCodePoint(n).length),r),!0):(t.processFailure(r,this),!1)};V.eval=function(t){const{inputStream:e}=t,r=e.pos;return e.atEnd()?(t.pushBinding(new Ne(0),r),!0):(t.processFailure(r,this),!1)};G.prototype.eval=function(t){const{inputStream:e}=t,r=e.pos;return e.matchString(this.obj)?(t.pushBinding(new Ne(this.obj.length),r),!0):(t.processFailure(r,this),!1)};K.prototype.eval=function(t){const{inputStream:e}=t,r=e.pos,n=this.matchCodePoint?e.nextCodePoint():e.nextCharCode();return n!==void 0&&this.from.codePointAt(0)<=n&&n<=this.to.codePointAt(0)?(t.pushBinding(new Ne(String.fromCodePoint(n).length),r),!0):(t.processFailure(r,this),!1)};H.prototype.eval=function(t){return t.eval(t.currentApplication().args[this.index])};ne.prototype.eval=function(t){t.enterLexifiedContext();const e=t.eval(this.expr);return t.exitLexifiedContext(),e};D.prototype.eval=function(t){for(let e=0;e<this.terms.length;e++)if(t.eval(this.terms[e]))return!0;return!1};T.prototype.eval=function(t){for(let e=0;e<this.factors.length;e++){const r=this.factors[e];if(!t.eval(r))return!1}return!0};Q.prototype.eval=function(t){const{inputStream:e}=t,r=e.pos,n=this.getArity(),i=[],s=[];for(;i.length<n;)i.push([]),s.push([]);let o=0,a=r,l;for(;o<this.maxNumMatches&&t.eval(this.expr);){if(e.pos===a)throw en(this,t._applicationStack);a=e.pos,o++;const h=t._bindings.splice(t._bindings.length-n,n),m=t._bindingOffsets.splice(t._bindingOffsets.length-n,n);for(l=0;l<h.length;l++)i[l].push(h[l]),s[l].push(m[l])}if(o<this.minNumMatches)return!1;let p=t.posToOffset(r),c=0;if(o>0){const h=i[n-1],m=s[n-1],d=m[m.length-1]+h[h.length-1].matchLength;p=s[0][0],c=d-p}const u=this instanceof fe;for(l=0;l<i.length;l++)t._bindings.push(new an(i[l],s[l],c,u)),t._bindingOffsets.push(p);return!0};Y.prototype.eval=function(t){const{inputStream:e}=t,r=e.pos;t.pushFailuresInfo();const n=t.eval(this.expr);return t.popFailuresInfo(),n?(t.processFailure(r,this),!1):(e.pos=r,!0)};Z.prototype.eval=function(t){const{inputStream:e}=t,r=e.pos;return t.eval(this.expr)?(e.pos=r,!0):!1};x.prototype.eval=function(t){const e=t.currentApplication(),r=e?e.args:[],n=this.substituteParams(r),i=t.getCurrentPosInfo();if(i.isActive(n))return n.handleCycle(t);const s=n.toMemoKey(),o=i.memo[s];if(o&&i.shouldUseMemoizedResult(o)){if(t.hasNecessaryInfo(o))return t.useMemoizedResult(t.inputStream.pos,o);delete i.memo[s]}return n.reallyEval(t)};x.prototype.handleCycle=function(t){const e=t.getCurrentPosInfo(),{currentLeftRecursion:r}=e,n=this.toMemoKey();let i=e.memo[n];return r&&r.headApplication.toMemoKey()===n?i.updateInvolvedApplicationMemoKeys():i||(i=e.memoize(n,{matchLength:0,examinedLength:0,value:!1,rightmostFailureOffset:-1}),e.startLeftRecursion(this,i)),t.useMemoizedResult(t.inputStream.pos,i)};x.prototype.reallyEval=function(t){const{inputStream:e}=t,r=e.pos,n=t.getCurrentPosInfo(),i=t.grammar.rules[this.ruleName],{body:s}=i,{description:o}=i;t.enterApplication(n,this),o&&t.pushFailuresInfo();const a=e.examinedLength;e.examinedLength=0;let l=this.evalOnce(s,t);const p=n.currentLeftRecursion,c=this.toMemoKey(),u=p&&p.headApplication.toMemoKey()===c;let h;t.doNotMemoize?t.doNotMemoize=!1:u?(l=this.growSeedResult(s,t,r,p,l),n.endLeftRecursion(),h=p,h.examinedLength=e.examinedLength-r,h.rightmostFailureOffset=t._getRightmostFailureOffset(),n.memoize(c,h)):(!p||!p.isInvolved(c))&&(h=n.memoize(c,{matchLength:e.pos-r,examinedLength:e.examinedLength-r,value:l,failuresAtRightmostPosition:t.cloneRecordedFailures(),rightmostFailureOffset:t._getRightmostFailureOffset()}));const m=!!l;if(o&&(t.popFailuresInfo(),m||t.processFailure(r,this),h&&(h.failuresAtRightmostPosition=t.cloneRecordedFailures())),t.isTracing()&&h){const d=t.getTraceEntry(r,this,m,m?[l]:[]);u&&(ve(d.terminatingLREntry!=null||!m),d.isHeadOfLeftRecursion=!0),h.traceEntry=d}return e.examinedLength=Math.max(e.examinedLength,a),t.exitApplication(n,l),m};x.prototype.evalOnce=function(t,e){const{inputStream:r}=e,n=r.pos;if(e.eval(t)){const i=t.getArity(),s=e._bindings.splice(e._bindings.length-i,i),o=e._bindingOffsets.splice(e._bindingOffsets.length-i,i),a=r.pos-n;return new Wi(this.ruleName,s,o,a)}else return!1};x.prototype.growSeedResult=function(t,e,r,n,i){if(!i)return!1;const{inputStream:s}=e;for(;;){if(n.matchLength=s.pos-r,n.value=i,n.failuresAtRightmostPosition=e.cloneRecordedFailures(),e.isTracing()){const o=e.trace[e.trace.length-1];n.traceEntry=new ge(e.input,r,s.pos,this,!0,[i],[o.clone()])}if(s.pos=r,i=this.evalOnce(t,e),s.pos-r<=n.matchLength)break;e.isTracing()&&e.trace.splice(-2,1)}return e.isTracing()&&n.traceEntry.recordLRTermination(e.trace.pop(),i),s.pos=r+n.matchLength,n.value};B.prototype.eval=function(t){const{inputStream:e}=t,r=e.pos,n=e.next();return n&&this.pattern.test(n)?(t.pushBinding(new Ne(n.length),r),!0):(t.processFailure(r,this),!1)};I.prototype.getArity=j("getArity");z.getArity=V.getArity=G.prototype.getArity=K.prototype.getArity=H.prototype.getArity=x.prototype.getArity=B.prototype.getArity=function(){return 1};D.prototype.getArity=function(){return this.terms.length===0?0:this.terms[0].getArity()};T.prototype.getArity=function(){let t=0;for(let e=0;e<this.factors.length;e++)t+=this.factors[e].getArity();return t};Q.prototype.getArity=function(){return this.expr.getArity()};Y.prototype.getArity=function(){return 0};Z.prototype.getArity=ne.prototype.getArity=function(){return this.expr.getArity()};function le(t,e){const r={};if(t.source&&e){const n=t.source.relativeTo(e);r.sourceInterval=[n.startIdx,n.endIdx]}return r}I.prototype.outputRecipe=j("outputRecipe");z.outputRecipe=function(t,e){return["any",le(this,e)]};V.outputRecipe=function(t,e){return["end",le(this,e)]};G.prototype.outputRecipe=function(t,e){return["terminal",le(this,e),this.obj]};K.prototype.outputRecipe=function(t,e){return["range",le(this,e),this.from,this.to]};H.prototype.outputRecipe=function(t,e){return["param",le(this,e),this.index]};D.prototype.outputRecipe=function(t,e){return["alt",le(this,e)].concat(this.terms.map(r=>r.outputRecipe(t,e)))};ot.prototype.outputRecipe=function(t,e){return this.terms[0].outputRecipe(t,e)};at.prototype.outputRecipe=function(t,e){const r=this.terms.slice(0,this.expansionPos),n=this.terms.slice(this.expansionPos+1);return["splice",le(this,e),r.map(i=>i.outputRecipe(t,e)),n.map(i=>i.outputRecipe(t,e))]};T.prototype.outputRecipe=function(t,e){return["seq",le(this,e)].concat(this.factors.map(r=>r.outputRecipe(t,e)))};xe.prototype.outputRecipe=De.prototype.outputRecipe=fe.prototype.outputRecipe=Y.prototype.outputRecipe=Z.prototype.outputRecipe=ne.prototype.outputRecipe=function(t,e){return[this.constructor.name.toLowerCase(),le(this,e),this.expr.outputRecipe(t,e)]};x.prototype.outputRecipe=function(t,e){return["app",le(this,e),this.ruleName,this.args.map(r=>r.outputRecipe(t,e))]};B.prototype.outputRecipe=function(t,e){return["unicodeChar",le(this,e),this.category]};I.prototype.introduceParams=j("introduceParams");z.introduceParams=V.introduceParams=G.prototype.introduceParams=K.prototype.introduceParams=H.prototype.introduceParams=B.prototype.introduceParams=function(t){return this};D.prototype.introduceParams=function(t){return this.terms.forEach((e,r,n)=>{n[r]=e.introduceParams(t)}),this};T.prototype.introduceParams=function(t){return this.factors.forEach((e,r,n)=>{n[r]=e.introduceParams(t)}),this};Q.prototype.introduceParams=Y.prototype.introduceParams=Z.prototype.introduceParams=ne.prototype.introduceParams=function(t){return this.expr=this.expr.introduceParams(t),this};x.prototype.introduceParams=function(t){const e=t.indexOf(this.ruleName);if(e>=0){if(this.args.length>0)throw new Error("Parameterized rules cannot be passed as arguments to another rule.");return new H(e).withSource(this.source)}else return this.args.forEach((r,n,i)=>{i[n]=r.introduceParams(t)}),this};I.prototype.isNullable=function(t){return this._isNullable(t,Object.create(null))};I.prototype._isNullable=j("_isNullable");z._isNullable=K.prototype._isNullable=H.prototype._isNullable=De.prototype._isNullable=B.prototype._isNullable=function(t,e){return!1};V._isNullable=function(t,e){return!0};G.prototype._isNullable=function(t,e){return typeof this.obj=="string"?this.obj==="":!1};D.prototype._isNullable=function(t,e){return this.terms.length===0||this.terms.some(r=>r._isNullable(t,e))};T.prototype._isNullable=function(t,e){return this.factors.every(r=>r._isNullable(t,e))};xe.prototype._isNullable=fe.prototype._isNullable=Y.prototype._isNullable=Z.prototype._isNullable=function(t,e){return!0};ne.prototype._isNullable=function(t,e){return this.expr._isNullable(t,e)};x.prototype._isNullable=function(t,e){const r=this.toMemoKey();if(!Object.prototype.hasOwnProperty.call(e,r)){const{body:n}=t.rules[this.ruleName],i=n.substituteParams(this.args);e[r]=!1,e[r]=i._isNullable(t,e)}return e[r]};I.prototype.substituteParams=j("substituteParams");z.substituteParams=V.substituteParams=G.prototype.substituteParams=K.prototype.substituteParams=B.prototype.substituteParams=function(t){return this};H.prototype.substituteParams=function(t){return t[this.index]};D.prototype.substituteParams=function(t){return new D(this.terms.map(e=>e.substituteParams(t)))};T.prototype.substituteParams=function(t){return new T(this.factors.map(e=>e.substituteParams(t)))};Q.prototype.substituteParams=Y.prototype.substituteParams=Z.prototype.substituteParams=ne.prototype.substituteParams=function(t){return new this.constructor(this.expr.substituteParams(t))};x.prototype.substituteParams=function(t){if(this.args.length===0)return this;{const e=this.args.map(r=>r.substituteParams(t));return new x(this.ruleName,e)}};function ur(t){return/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(t)}function Mt(t){const e=Object.create(null);t.forEach(r=>{e[r]=(e[r]||0)+1}),Object.keys(e).forEach(r=>{if(e[r]<=1)return;let n=1;t.forEach((i,s)=>{i===r&&(t[s]=i+"_"+n++)})})}I.prototype.toArgumentNameList=j("toArgumentNameList");z.toArgumentNameList=function(t,e){return["any"]};V.toArgumentNameList=function(t,e){return["end"]};G.prototype.toArgumentNameList=function(t,e){return typeof this.obj=="string"&&/^[_a-zA-Z0-9]+$/.test(this.obj)?["_"+this.obj]:["$"+t]};K.prototype.toArgumentNameList=function(t,e){let r=this.from+"_to_"+this.to;return ur(r)||(r="_"+r),ur(r)||(r="$"+t),[r]};D.prototype.toArgumentNameList=function(t,e){const r=this.terms.map(s=>s.toArgumentNameList(t,!0)),n=[],i=r[0].length;for(let s=0;s<i;s++){const o=[];for(let l=0;l<this.terms.length;l++)o.push(r[l][s]);const a=Wr(o);n.push(a.join("_or_"))}return e||Mt(n),n};T.prototype.toArgumentNameList=function(t,e){let r=[];return this.factors.forEach(n=>{const i=n.toArgumentNameList(t,!0);r=r.concat(i),t+=i.length}),e||Mt(r),r};Q.prototype.toArgumentNameList=function(t,e){const r=this.expr.toArgumentNameList(t,e).map(n=>n[n.length-1]==="s"?n+"es":n+"s");return e||Mt(r),r};fe.prototype.toArgumentNameList=function(t,e){return this.expr.toArgumentNameList(t,e).map(r=>"opt"+r[0].toUpperCase()+r.slice(1))};Y.prototype.toArgumentNameList=function(t,e){return[]};Z.prototype.toArgumentNameList=ne.prototype.toArgumentNameList=function(t,e){return this.expr.toArgumentNameList(t,e)};x.prototype.toArgumentNameList=function(t,e){return[this.ruleName]};B.prototype.toArgumentNameList=function(t,e){return["$"+t]};H.prototype.toArgumentNameList=function(t,e){return["param"+this.index]};I.prototype.toDisplayString=j("toDisplayString");D.prototype.toDisplayString=T.prototype.toDisplayString=function(){return this.source?this.source.trimmed().contents:"["+this.constructor.name+"]"};z.toDisplayString=V.toDisplayString=Q.prototype.toDisplayString=Y.prototype.toDisplayString=Z.prototype.toDisplayString=ne.prototype.toDisplayString=G.prototype.toDisplayString=K.prototype.toDisplayString=H.prototype.toDisplayString=function(){return this.toString()};x.prototype.toDisplayString=function(){if(this.args.length>0){const t=this.args.map(e=>e.toDisplayString());return this.ruleName+"<"+t.join(",")+">"}else return this.ruleName};B.prototype.toDisplayString=function(){return"Unicode ["+this.category+"] character"};function Ji(t){return t==="description"||t==="string"||t==="code"}class ie{constructor(e,r,n){if(!Ji(n))throw new Error("invalid Failure type: "+n);this.pexpr=e,this.text=r,this.type=n,this.fluffy=!1}getPExpr(){return this.pexpr}getText(){return this.text}getType(){return this.type}isDescription(){return this.type==="description"}isStringTerminal(){return this.type==="string"}isCode(){return this.type==="code"}isFluffy(){return this.fluffy}makeFluffy(){this.fluffy=!0}clearFluffy(){this.fluffy=!1}subsumes(e){return this.getText()===e.getText()&&this.type===e.type&&(!this.isFluffy()||this.isFluffy()&&e.isFluffy())}toString(){return this.type==="string"?JSON.stringify(this.getText()):this.getText()}clone(){const e=new ie(this.pexpr,this.text,this.type);return this.isFluffy()&&e.makeFluffy(),e}toKey(){return this.toString()+"#"+this.type}}I.prototype.toFailure=j("toFailure");z.toFailure=function(t){return new ie(this,"any object","description")};V.toFailure=function(t){return new ie(this,"end of input","description")};G.prototype.toFailure=function(t){return new ie(this,this.obj,"string")};K.prototype.toFailure=function(t){return new ie(this,JSON.stringify(this.from)+".."+JSON.stringify(this.to),"code")};Y.prototype.toFailure=function(t){const e=this.expr===z?"nothing":"not "+this.expr.toFailure(t);return new ie(this,e,"description")};Z.prototype.toFailure=function(t){return this.expr.toFailure(t)};x.prototype.toFailure=function(t){let{description:e}=t.rules[this.ruleName];return e||(e=(/^[aeiouAEIOU]/.test(this.ruleName)?"an":"a")+" "+this.ruleName),new ie(this,e,"description")};B.prototype.toFailure=function(t){return new ie(this,"a Unicode ["+this.category+"] character","description")};D.prototype.toFailure=function(t){const r="("+this.terms.map(n=>n.toFailure(t)).join(" or ")+")";return new ie(this,r,"description")};T.prototype.toFailure=function(t){const r="("+this.factors.map(n=>n.toFailure(t)).join(" ")+")";return new ie(this,r,"description")};Q.prototype.toFailure=function(t){const e="("+this.expr.toFailure(t)+this.operator+")";return new ie(this,e,"description")};I.prototype.toString=j("toString");z.toString=function(){return"any"};V.toString=function(){return"end"};G.prototype.toString=function(){return JSON.stringify(this.obj)};K.prototype.toString=function(){return JSON.stringify(this.from)+".."+JSON.stringify(this.to)};H.prototype.toString=function(){return"$"+this.index};ne.prototype.toString=function(){return"#("+this.expr.toString()+")"};D.prototype.toString=function(){return this.terms.length===1?this.terms[0].toString():"("+this.terms.map(t=>t.toString()).join(" | ")+")"};T.prototype.toString=function(){return this.factors.length===1?this.factors[0].toString():"("+this.factors.map(t=>t.toString()).join(" ")+")"};Q.prototype.toString=function(){return this.expr+this.operator};Y.prototype.toString=function(){return"~"+this.expr};Z.prototype.toString=function(){return"&"+this.expr};x.prototype.toString=function(){if(this.args.length>0){const t=this.args.map(e=>e.toString());return this.ruleName+"<"+t.join(",")+">"}else return this.ruleName};B.prototype.toString=function(){return"\\p{"+this.category+"}"};class kt extends I{constructor(e){super(),this.obj=e}_getString(e){const r=e.currentApplication().args[this.obj.index];return ve(r instanceof G,"expected a Terminal expression"),r.obj}allowsSkippingPrecedingSpace(){return!0}eval(e){const{inputStream:r}=e,n=r.pos,i=this._getString(e);return r.matchString(i,!0)?(e.pushBinding(new Ne(i.length),n),!0):(e.processFailure(n,this),!1)}getArity(){return 1}substituteParams(e){return new kt(this.obj.substituteParams(e))}toDisplayString(){return this.obj.toDisplayString()+" (case-insensitive)"}toFailure(e){return new ie(this,this.obj.toFailure(e)+" (case-insensitive)","description")}_isNullable(e,r){return this.obj._isNullable(e,r)}}let ln;rn(t=>{ln=t.rules.applySyntactic.body});const mt=new x("spaces");class Xi{constructor(e,r,n){this.matcher=e,this.startExpr=r,this.grammar=e.grammar,this.input=e.getInput(),this.inputStream=new lt(this.input),this.memoTable=e._memoTable,this.userData=void 0,this.doNotMemoize=!1,this._bindings=[],this._bindingOffsets=[],this._applicationStack=[],this._posStack=[0],this.inLexifiedContextStack=[!1],this.rightmostFailurePosition=-1,this._rightmostFailurePositionStack=[],this._recordedFailuresStack=[],n!==void 0&&(this.positionToRecordFailures=n,this.recordedFailures=Object.create(null))}posToOffset(e){return e-this._posStack[this._posStack.length-1]}enterApplication(e,r){this._posStack.push(this.inputStream.pos),this._applicationStack.push(r),this.inLexifiedContextStack.push(!1),e.enter(r),this._rightmostFailurePositionStack.push(this.rightmostFailurePosition),this.rightmostFailurePosition=-1}exitApplication(e,r){const n=this._posStack.pop();this._applicationStack.pop(),this.inLexifiedContextStack.pop(),e.exit(),this.rightmostFailurePosition=Math.max(this.rightmostFailurePosition,this._rightmostFailurePositionStack.pop()),r&&this.pushBinding(r,n)}enterLexifiedContext(){this.inLexifiedContextStack.push(!0)}exitLexifiedContext(){this.inLexifiedContextStack.pop()}currentApplication(){return this._applicationStack[this._applicationStack.length-1]}inSyntacticContext(){const e=this.currentApplication();return e?e.isSyntactic()&&!this.inLexifiedContext():this.startExpr.factors[0].isSyntactic()}inLexifiedContext(){return this.inLexifiedContextStack[this.inLexifiedContextStack.length-1]}skipSpaces(){return this.pushFailuresInfo(),this.eval(mt),this.popBinding(),this.popFailuresInfo(),this.inputStream.pos}skipSpacesIfInSyntacticContext(){return this.inSyntacticContext()?this.skipSpaces():this.inputStream.pos}maybeSkipSpacesBefore(e){return e.allowsSkippingPrecedingSpace()&&e!==mt?this.skipSpacesIfInSyntacticContext():this.inputStream.pos}pushBinding(e,r){this._bindings.push(e),this._bindingOffsets.push(this.posToOffset(r))}popBinding(){this._bindings.pop(),this._bindingOffsets.pop()}numBindings(){return this._bindings.length}truncateBindings(e){for(;this._bindings.length>e;)this.popBinding()}getCurrentPosInfo(){return this.getPosInfo(this.inputStream.pos)}getPosInfo(e){let r=this.memoTable[e];return r||(r=this.memoTable[e]=new ki),r}processFailure(e,r){if(this.rightmostFailurePosition=Math.max(this.rightmostFailurePosition,e),this.recordedFailures&&e===this.positionToRecordFailures){const n=this.currentApplication();n&&(r=r.substituteParams(n.args)),this.recordFailure(r.toFailure(this.grammar),!1)}}recordFailure(e,r){const n=e.toKey();this.recordedFailures[n]?this.recordedFailures[n].isFluffy()&&!e.isFluffy()&&this.recordedFailures[n].clearFluffy():this.recordedFailures[n]=r?e.clone():e}recordFailures(e,r){Object.keys(e).forEach(n=>{this.recordFailure(e[n],r)})}cloneRecordedFailures(){if(!this.recordedFailures)return;const e=Object.create(null);return Object.keys(this.recordedFailures).forEach(r=>{e[r]=this.recordedFailures[r].clone()}),e}getRightmostFailurePosition(){return this.rightmostFailurePosition}_getRightmostFailureOffset(){return this.rightmostFailurePosition>=0?this.posToOffset(this.rightmostFailurePosition):-1}getMemoizedTraceEntry(e,r){const n=this.memoTable[e];if(n&&r instanceof x){const i=n.memo[r.toMemoKey()];if(i&&i.traceEntry){const s=i.traceEntry.cloneWithExpr(r);return s.isMemoized=!0,s}}return null}getTraceEntry(e,r,n,i){if(r instanceof x){const s=this.currentApplication(),o=s?s.args:[];r=r.substituteParams(o)}return this.getMemoizedTraceEntry(e,r)||new ge(this.input,e,this.inputStream.pos,r,n,i,this.trace)}isTracing(){return!!this.trace}hasNecessaryInfo(e){return this.trace&&!e.traceEntry?!1:this.recordedFailures&&this.inputStream.pos+e.rightmostFailureOffset===this.positionToRecordFailures?!!e.failuresAtRightmostPosition:!0}useMemoizedResult(e,r){this.trace&&this.trace.push(r.traceEntry);const n=this.inputStream.pos+r.rightmostFailureOffset;return this.rightmostFailurePosition=Math.max(this.rightmostFailurePosition,n),this.recordedFailures&&this.positionToRecordFailures===n&&r.failuresAtRightmostPosition&&this.recordFailures(r.failuresAtRightmostPosition,!0),this.inputStream.examinedLength=Math.max(this.inputStream.examinedLength,r.examinedLength+e),r.value?(this.inputStream.pos+=r.matchLength,this.pushBinding(r.value,e),!0):!1}eval(e){const{inputStream:r}=this,n=this._bindings.length,i=this.userData;let s;this.recordedFailures&&(s=this.recordedFailures,this.recordedFailures=Object.create(null));const o=r.pos,a=this.maybeSkipSpacesBefore(e);let l;this.trace&&(l=this.trace,this.trace=[]);const p=e.eval(this);if(this.trace){const c=this._bindings.slice(n),u=this.getTraceEntry(a,e,p,c);u.isImplicitSpaces=e===mt,u.isRootNode=e===this.startExpr,l.push(u),this.trace=l}return p?this.recordedFailures&&r.pos===this.positionToRecordFailures&&Object.keys(this.recordedFailures).forEach(c=>{this.recordedFailures[c].makeFluffy()}):(r.pos=o,this.truncateBindings(n),this.userData=i),this.recordedFailures&&this.recordFailures(s,!1),e===ln&&this.skipSpaces(),p}getMatchResult(){this.grammar._setUpMatchState(this),this.eval(this.startExpr);let e;this.recordedFailures&&(e=Object.keys(this.recordedFailures).map(n=>this.recordedFailures[n]));const r=this._bindings[0];return r&&(r.grammar=this.grammar),new sn(this.matcher,this.input,this.startExpr,r,this._bindingOffsets[0],this.rightmostFailurePosition,e)}getTrace(){this.trace=[];const e=this.getMatchResult(),r=this.trace[this.trace.length-1];return r.result=e,r}pushFailuresInfo(){this._rightmostFailurePositionStack.push(this.rightmostFailurePosition),this._recordedFailuresStack.push(this.recordedFailures)}popFailuresInfo(){this.rightmostFailurePosition=this._rightmostFailurePositionStack.pop(),this.recordedFailures=this._recordedFailuresStack.pop()}}class ji{constructor(e){this.grammar=e,this._memoTable=[],this._input="",this._isMemoTableStale=!1}_resetMemoTable(){this._memoTable=[],this._isMemoTableStale=!1}getInput(){return this._input}setInput(e){return this._input!==e&&this.replaceInputRange(0,this._input.length,e),this}replaceInputRange(e,r,n){const i=this._input,s=this._memoTable;if(e<0||e>i.length||r<0||r>i.length||e>r)throw new Error("Invalid indices: "+e+" and "+r);this._input=i.slice(0,e)+n+i.slice(r),this._input!==i&&s.length>0&&(this._isMemoTableStale=!0);const o=s.slice(r);s.length=e;for(let a=0;a<n.length;a++)s.push(void 0);for(const a of o)s.push(a);for(let a=0;a<e;a++){const l=s[a];l&&l.clearObsoleteEntries(a,e)}return this}match(e,r={incremental:!0}){return this._match(this._getStartExpr(e),{incremental:r.incremental,tracing:!1})}trace(e,r={incremental:!0}){return this._match(this._getStartExpr(e),{incremental:r.incremental,tracing:!0})}_match(e,r={}){const n={tracing:!1,incremental:!0,positionToRecordFailures:void 0,...r};if(!n.incremental)this._resetMemoTable();else if(this._isMemoTableStale&&!this.grammar.supportsIncrementalParsing)throw yi(this.grammar);const i=new Xi(this,e,n.positionToRecordFailures);return n.tracing?i.getTrace():i.getMatchResult()}_getStartExpr(e){const r=e||this.grammar.defaultStartRule;if(!r)throw new Error("Missing start rule argument -- the grammar has no default start rule.");const n=this.grammar.parseApplication(r);return new T([n,V])}}const Be=[],xt=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);class cr{constructor(e,r,n){this._node=e,this.source=r,this._baseInterval=n,e.isNonterminal()&&ve(r===n),this._childWrappers=[]}_forgetMemoizedResultFor(e){delete this._node[this._semantics.attributeKeys[e]],this.children.forEach(r=>{r._forgetMemoizedResultFor(e)})}child(e){if(!(0<=e&&e<this._node.numChildren()))return;let r=this._childWrappers[e];if(!r){const n=this._node.childAt(e),i=this._node.childOffsets[e],s=this._baseInterval.subInterval(i,n.matchLength),o=n.isNonterminal()?s:this._baseInterval;r=this._childWrappers[e]=this._semantics.wrap(n,s,o)}return r}_children(){for(let e=0;e<this._node.numChildren();e++)this.child(e);return this._childWrappers}isIteration(){return this._node.isIteration()}isTerminal(){return this._node.isTerminal()}isNonterminal(){return this._node.isNonterminal()}isSyntactic(){return this.isNonterminal()&&this._node.isSyntactic()}isLexical(){return this.isNonterminal()&&this._node.isLexical()}isOptional(){return this._node.isOptional()}iteration(e){const r=e||[],n=r.map(o=>o._node),i=new an(n,[],-1,!1),s=this._semantics.wrap(i,null,null);return s._childWrappers=r,s}get children(){return this._children()}get ctorName(){return this._node.ctorName}get numChildren(){return this._node.numChildren()}get sourceString(){return this.source.contents}}class ee{constructor(e,r){const n=this;if(this.grammar=e,this.checkedActionDicts=!1,this.Wrapper=class extends(r?r.Wrapper:cr){constructor(i,s,o){super(i,s,o),n.checkActionDictsIfHaventAlready(),this._semantics=n}toString(){return"[semantics wrapper for "+n.grammar.name+"]"}},this.super=r,r){if(!(e.equals(this.super.grammar)||e._inheritsFrom(this.super.grammar)))throw new Error("Cannot extend a semantics for grammar '"+this.super.grammar.name+"' for use with grammar '"+e.name+"' (not a sub-grammar)");this.operations=Object.create(this.super.operations),this.attributes=Object.create(this.super.attributes),this.attributeKeys=Object.create(null);for(const i in this.attributes)Object.defineProperty(this.attributeKeys,i,{value:lr(i)})}else this.operations=Object.create(null),this.attributes=Object.create(null),this.attributeKeys=Object.create(null)}toString(){return"[semantics for "+this.grammar.name+"]"}checkActionDictsIfHaventAlready(){this.checkedActionDicts||(this.checkActionDicts(),this.checkedActionDicts=!0)}checkActionDicts(){let e;for(e in this.operations)this.operations[e].checkActionDict(this.grammar);for(e in this.attributes)this.attributes[e].checkActionDict(this.grammar)}toRecipe(e){function r(i){return i.super!==ee.BuiltInSemantics._getSemantics()}let n=`(function(g) {
`;if(r(this)){n+="  var semantics = "+this.super.toRecipe(!0)+"(g";const i=this.super.grammar;let s=this.grammar;for(;s!==i;)n+=".superGrammar",s=s.superGrammar;n+=`);
`,n+="  return g.extendSemantics(semantics)"}else n+="  return g.createSemantics()";return["Operation","Attribute"].forEach(i=>{const s=this[i.toLowerCase()+"s"];Object.keys(s).forEach(o=>{const{actionDict:a,formals:l,builtInDefault:p}=s[o];let c=o;l.length>0&&(c+="("+l.join(", ")+")");let u;r(this)&&this.super[i.toLowerCase()+"s"][o]?u="extend"+i:u="add"+i,n+=`
    .`+u+"("+JSON.stringify(c)+", {";const h=[];Object.keys(a).forEach(m=>{if(a[m]!==p){let d=a[m].toString().trim();d=d.replace(/^.*\(/,"function("),h.push(`
      `+JSON.stringify(m)+": "+d)}}),n+=h.join(",")+`
    })`})}),n+=`;
  })`,e||(n=`(function() {
  var grammar = this.fromRecipe(`+this.grammar.toRecipe()+`);
  var semantics = `+n+`(grammar);
  return semantics;
});
`),n}addOperationOrAttribute(e,r,n){const i=e+"s",s=pr(r,e),{name:o}=s,{formals:a}=s;this.assertNewName(o,e);const l=Qi(e,o,u),p={_default:l};Object.keys(n).forEach(h=>{p[h]=n[h]});const c=e==="operation"?new Ge(o,a,p,l):new Nt(o,p,l);c.checkActionDict(this.grammar),this[i][o]=c;function u(...h){const m=this._semantics[i][o];if(arguments.length!==m.formals.length)throw new Error("Invalid number of arguments passed to "+o+" "+e+" (expected "+m.formals.length+", got "+arguments.length+")");const d=Object.create(null);for(const[v,_]of Object.entries(h)){const y=m.formals[v];d[y]=_}const g=this.args;this.args=d;const f=m.execute(this._semantics,this);return this.args=g,f}e==="operation"?(this.Wrapper.prototype[o]=u,this.Wrapper.prototype[o].toString=function(){return"["+o+" operation]"}):(Object.defineProperty(this.Wrapper.prototype,o,{get:u,configurable:!0}),Object.defineProperty(this.attributeKeys,o,{value:lr(o)}))}extendOperationOrAttribute(e,r,n){const i=e+"s";if(pr(r,"attribute"),!(this.super&&r in this.super[i]))throw new Error("Cannot extend "+e+" '"+r+"': did not inherit an "+e+" with that name");if(xt(this[i],r))throw new Error("Cannot extend "+e+" '"+r+"' again");const s=this[i][r].formals,o=this[i][r].actionDict,a=Object.create(o);Object.keys(n).forEach(l=>{a[l]=n[l]}),this[i][r]=e==="operation"?new Ge(r,s,a):new Nt(r,a),this[i][r].checkActionDict(this.grammar)}assertNewName(e,r){if(xt(cr.prototype,e))throw new Error("Cannot add "+r+" '"+e+"': that's a reserved name");if(e in this.operations)throw new Error("Cannot add "+r+" '"+e+"': an operation with that name already exists");if(e in this.attributes)throw new Error("Cannot add "+r+" '"+e+"': an attribute with that name already exists")}wrap(e,r,n){const i=n||r;return e instanceof this.Wrapper?e:new this.Wrapper(e,r,i)}}function pr(t,e){if(!ee.prototypeGrammar)return ve(t.indexOf("(")===-1),{name:t,formals:[]};const r=ee.prototypeGrammar.match(t,e==="operation"?"OperationSignature":"AttributeSignature");if(r.failed())throw new Error(r.message);return ee.prototypeGrammarSemantics(r).parse()}function Qi(t,e,r){return function(...n){const s=(this._semantics.operations[e]||this._semantics.attributes[e]).formals.map(o=>this.args[o]);if(!this.isIteration()&&n.length===1)return r.apply(n[0],s);throw Ei(this.ctorName,e,t,Be)}}ee.createSemantics=function(t,e){const r=new ee(t,e!==void 0?e:ee.BuiltInSemantics._getSemantics()),n=function(s){if(!(s instanceof sn))throw new TypeError("Semantics expected a MatchResult, but got "+Qr(s));if(s.failed())throw new TypeError("cannot apply Semantics to "+s.toString());const o=s._cst;if(o.grammar!==t)throw new Error("Cannot use a MatchResult from grammar '"+o.grammar.name+"' with a semantics for '"+t.name+"'");const a=new lt(s.input);return r.wrap(o,a.interval(s._cstOffset,s.input.length))};return n.addOperation=function(i,s){return r.addOperationOrAttribute("operation",i,s),n},n.extendOperation=function(i,s){return r.extendOperationOrAttribute("operation",i,s),n},n.addAttribute=function(i,s){return r.addOperationOrAttribute("attribute",i,s),n},n.extendAttribute=function(i,s){return r.extendOperationOrAttribute("attribute",i,s),n},n._getActionDict=function(i){const s=r.operations[i]||r.attributes[i];if(!s)throw new Error('"'+i+'" is not a valid operation or attribute name in this semantics for "'+t.name+'"');return s.actionDict},n._remove=function(i){let s;return i in r.operations?(s=r.operations[i],delete r.operations[i]):i in r.attributes&&(s=r.attributes[i],delete r.attributes[i]),delete r.Wrapper.prototype[i],s},n.getOperationNames=function(){return Object.keys(r.operations)},n.getAttributeNames=function(){return Object.keys(r.attributes)},n.getGrammar=function(){return r.grammar},n.toRecipe=function(i){return r.toRecipe(i)},n.toString=r.toString.bind(r),n._getSemantics=function(){return r},n};class Ge{constructor(e,r,n,i){this.name=e,this.formals=r,this.actionDict=n,this.builtInDefault=i}checkActionDict(e){e._checkTopDownActionDict(this.typeName,this.name,this.actionDict)}execute(e,r){try{const{ctorName:n}=r._node;let i=this.actionDict[n];return i?(Be.push([this,n]),i.apply(r,r._children())):r.isNonterminal()&&(i=this.actionDict._nonterminal,i)?(Be.push([this,"_nonterminal",n]),i.apply(r,r._children())):(Be.push([this,"default action",n]),this.actionDict._default.apply(r,r._children()))}finally{Be.pop()}}}Ge.prototype.typeName="operation";class Nt extends Ge{constructor(e,r,n){super(e,[],r,n)}execute(e,r){const n=r._node,i=e.attributeKeys[this.name];return xt(n,i)||(n[i]=Ge.prototype.execute.call(this,e,r)),n[i]}}Nt.prototype.typeName="attribute";const hr=["_iter","_terminal","_nonterminal","_default"];function fr(t){return Object.keys(t.rules).sort().map(e=>t.rules[e])}const Yi=t=>t.replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029");let un,cn;class J{constructor(e,r,n,i){if(this.name=e,this.superGrammar=r,this.rules=n,i){if(!(i in n))throw new Error("Invalid start rule: '"+i+"' is not a rule in grammar '"+e+"'");this.defaultStartRule=i}this._matchStateInitializer=void 0,this.supportsIncrementalParsing=!0}matcher(){return new ji(this)}isBuiltIn(){return this===J.ProtoBuiltInRules||this===J.BuiltInRules}equals(e){if(this===e)return!0;if(e==null||this.name!==e.name||this.defaultStartRule!==e.defaultStartRule||!(this.superGrammar===e.superGrammar||this.superGrammar.equals(e.superGrammar)))return!1;const r=fr(this),n=fr(e);return r.length===n.length&&r.every((i,s)=>i.description===n[s].description&&i.formals.join(",")===n[s].formals.join(",")&&i.body.toString()===n[s].body.toString())}match(e,r){const n=this.matcher();return n.replaceInputRange(0,0,e),n.match(r)}trace(e,r){const n=this.matcher();return n.replaceInputRange(0,0,e),n.trace(r)}createSemantics(){return ee.createSemantics(this)}extendSemantics(e){return ee.createSemantics(this,e._getSemantics())}_checkTopDownActionDict(e,r,n){const i=[];for(const s in n){const o=n[s];if(!hr.includes(s)&&!(s in this.rules)){i.push(`'${s}' is not a valid semantic action for '${this.name}'`);continue}if(typeof o!="function"){i.push(`'${s}' must be a function in an action dictionary for '${this.name}'`);continue}const l=o.length,p=this._topDownActionArity(s);if(l!==p){let c;s==="_iter"||s==="_nonterminal"?c=`it should use a rest parameter, e.g. \`${s}(...children) {}\`. NOTE: this is new in Ohm v16 — see https://ohmjs.org/d/ati for details.`:c=`expected ${p}, got ${l}`,i.push(`Semantic action '${s}' has the wrong arity: ${c}`)}}if(i.length>0){const s=i.map(a=>"- "+a),o=new Error([`Found errors in the action dictionary of the '${r}' ${e}:`,...s].join(`
`));throw o.problems=i,o}}_topDownActionArity(e){return hr.includes(e)?0:this.rules[e].body.getArity()}_inheritsFrom(e){let r=this.superGrammar;for(;r;){if(r.equals(e,!0))return!0;r=r.superGrammar}return!1}toRecipe(e=void 0){const r={};this.source&&(r.source=this.source.contents);let n=null;this.defaultStartRule&&(n=this.defaultStartRule);const i={};Object.keys(this.rules).forEach(a=>{const l=this.rules[a],{body:p}=l,c=!this.superGrammar||!this.superGrammar.rules[a];let u;c?u="define":u=p instanceof ot?"extend":"override";const h={};if(l.source&&this.source){const g=l.source.relativeTo(this.source);h.sourceInterval=[g.startIdx,g.endIdx]}const m=c?l.description:null,d=p.outputRecipe(l.formals,this.source);i[a]=[u,h,m,l.formals,d]});let s="null";e?s=e:this.superGrammar&&!this.superGrammar.isBuiltIn()&&(s=this.superGrammar.toRecipe());const o=[...["grammar",r,this.name].map(JSON.stringify),s,...[n,i].map(JSON.stringify)];return Yi(`[${o.join(",")}]`)}toOperationActionDictionaryTemplate(){return this._toOperationOrAttributeActionDictionaryTemplate()}toAttributeActionDictionaryTemplate(){return this._toOperationOrAttributeActionDictionaryTemplate()}_toOperationOrAttributeActionDictionaryTemplate(){const e=new we;e.append("{");let r=!0;for(const n in this.rules){const{body:i}=this.rules[n];r?r=!1:e.append(","),e.append(`
`),e.append("  "),this.addSemanticActionTemplate(n,i,e)}return e.append(`
}`),e.contents()}addSemanticActionTemplate(e,r,n){n.append(e),n.append(": function(");const i=this._topDownActionArity(e);n.append(st("_",i).join(", ")),n.append(`) {
`),n.append("  }")}parseApplication(e){let r;if(e.indexOf("<")===-1)r=new x(e);else{const i=un.match(e,"Base_application");r=cn(i,{})}if(!(r.ruleName in this.rules))throw Yr(r.ruleName,this.name);const{formals:n}=this.rules[r.ruleName];if(n.length!==r.args.length){const{source:i}=this.rules[r.ruleName];throw Zr(r.ruleName,n.length,r.args.length,i)}return r}_setUpMatchState(e){this._matchStateInitializer&&this._matchStateInitializer(e)}}J.ProtoBuiltInRules=new J("ProtoBuiltInRules",void 0,{any:{body:z,formals:[],description:"any character",primitive:!0},end:{body:V,formals:[],description:"end of input",primitive:!0},caseInsensitive:{body:new kt(new H(0)),formals:["str"],primitive:!0},lower:{body:new B("Ll"),formals:[],description:"a lowercase letter",primitive:!0},upper:{body:new B("Lu"),formals:[],description:"an uppercase letter",primitive:!0},unicodeLtmo:{body:new B("Ltmo"),formals:[],description:"a Unicode character in Lt, Lm, or Lo",primitive:!0},spaces:{body:new xe(new x("space")),formals:[]},space:{body:new K("\0"," "),formals:[],description:"a space"}});J.initApplicationParser=function(t,e){un=t,cn=e};class mr{constructor(e){this.name=e}sourceInterval(e,r){return this.source.subInterval(e,r-e)}ensureSuperGrammar(){return this.superGrammar||this.withSuperGrammar(this.name==="BuiltInRules"?J.ProtoBuiltInRules:J.BuiltInRules),this.superGrammar}ensureSuperGrammarRuleForOverriding(e,r){const n=this.ensureSuperGrammar().rules[e];if(!n)throw _i(e,this.superGrammar.name,r);return n}installOverriddenOrExtendedRule(e,r,n,i){const s=_t(r);if(s.length>0)throw sr(e,s,i);const o=this.ensureSuperGrammar().rules[e],a=o.formals,l=a?a.length:0;if(r.length!==l)throw Zr(e,l,r.length,i);return this.install(e,r,n,o.description,i)}install(e,r,n,i,s,o=!1){return this.rules[e]={body:n.introduceParams(r),formals:r,description:i,source:s,primitive:o},this}withSuperGrammar(e){if(this.superGrammar)throw new Error("the super grammar of a GrammarDecl cannot be set more than once");return this.superGrammar=e,this.rules=Object.create(e.rules),e.isBuiltIn()||(this.defaultStartRule=e.defaultStartRule),this}withDefaultStartRule(e){return this.defaultStartRule=e,this}withSource(e){return this.source=new lt(e).interval(0,e.length),this}build(){const e=new J(this.name,this.ensureSuperGrammar(),this.rules,this.defaultStartRule);e._matchStateInitializer=e.superGrammar._matchStateInitializer,e.supportsIncrementalParsing=e.superGrammar.supportsIncrementalParsing;const r=[];let n=!1;return Object.keys(e.rules).forEach(i=>{const{body:s}=e.rules[i];try{s.assertChoicesHaveUniformArity(i)}catch(o){r.push(o)}try{s.assertAllApplicationsAreValid(i,e)}catch(o){r.push(o),n=!0}}),n||Object.keys(e.rules).forEach(i=>{const{body:s}=e.rules[i];try{s.assertIteratedExprsAreNotNullable(e,[])}catch(o){r.push(o)}}),r.length>0&&Fi(r),this.source&&(e.source=this.source),e}define(e,r,n,i,s,o){if(this.ensureSuperGrammar(),this.superGrammar.rules[e])throw ir(e,this.name,this.superGrammar.name,s);if(this.rules[e])throw ir(e,this.name,this.name,s);const a=_t(r);if(a.length>0)throw sr(e,a,s);return this.install(e,r,n,i,s,o)}override(e,r,n,i,s){return this.ensureSuperGrammarRuleForOverriding(e,s),this.installOverriddenOrExtendedRule(e,r,n,s),this}extend(e,r,n,i,s){if(!this.ensureSuperGrammar().rules[e])throw Si(e,this.superGrammar.name,s);const a=new ot(this.superGrammar,e,n);return a.source=n.source,this.installOverriddenOrExtendedRule(e,r,a,s),this}}class tt{constructor(){this.currentDecl=null,this.currentRuleName=null}newGrammar(e){return new mr(e)}grammar(e,r,n,i,s){const o=new mr(r);return n&&o.withSuperGrammar(n instanceof J?n:this.fromRecipe(n)),i&&o.withDefaultStartRule(i),e&&e.source&&o.withSource(e.source),this.currentDecl=o,Object.keys(s).forEach(a=>{this.currentRuleName=a;const l=s[a],p=l[0],c=l[1],u=l[2],h=l[3],m=this.fromRecipe(l[4]);let d;o.source&&c&&c.sourceInterval&&(d=o.source.subInterval(c.sourceInterval[0],c.sourceInterval[1]-c.sourceInterval[0])),o[p](a,h,m,u,d)}),this.currentRuleName=this.currentDecl=null,o.build()}terminal(e){return new G(e)}range(e,r){return new K(e,r)}param(e){return new H(e)}alt(...e){let r=[];for(let n of e)n instanceof I||(n=this.fromRecipe(n)),n instanceof D?r=r.concat(n.terms):r.push(n);return r.length===1?r[0]:new D(r)}seq(...e){let r=[];for(let n of e)n instanceof I||(n=this.fromRecipe(n)),n instanceof T?r=r.concat(n.factors):r.push(n);return r.length===1?r[0]:new T(r)}star(e){return e instanceof I||(e=this.fromRecipe(e)),new xe(e)}plus(e){return e instanceof I||(e=this.fromRecipe(e)),new De(e)}opt(e){return e instanceof I||(e=this.fromRecipe(e)),new fe(e)}not(e){return e instanceof I||(e=this.fromRecipe(e)),new Y(e)}lookahead(e){return e instanceof I||(e=this.fromRecipe(e)),new Z(e)}lex(e){return e instanceof I||(e=this.fromRecipe(e)),new ne(e)}app(e,r){return r&&r.length>0&&(r=r.map(function(n){return n instanceof I?n:this.fromRecipe(n)},this)),new x(e,r)}splice(e,r){return new at(this.currentDecl.superGrammar,this.currentRuleName,e.map(n=>this.fromRecipe(n)),r.map(n=>this.fromRecipe(n)))}fromRecipe(e){const r=e[0]==="grammar"?e.slice(1):e.slice(2),n=this[e[0]](...r),i=e[1];return i&&i.sourceInterval&&this.currentDecl&&n.withSource(this.currentDecl.sourceInterval(...i.sourceInterval)),n}}function ut(t){return typeof t=="function"?t.call(new tt):(typeof t=="string"&&(t=JSON.parse(t)),new tt().fromRecipe(t))}const Bt=ut(["grammar",{source:`BuiltInRules {

  alnum  (an alpha-numeric character)
    = letter
    | digit

  letter  (a letter)
    = lower
    | upper
    | unicodeLtmo

  digit  (a digit)
    = "0".."9"

  hexDigit  (a hexadecimal digit)
    = digit
    | "a".."f"
    | "A".."F"

  ListOf<elem, sep>
    = NonemptyListOf<elem, sep>
    | EmptyListOf<elem, sep>

  NonemptyListOf<elem, sep>
    = elem (sep elem)*

  EmptyListOf<elem, sep>
    = /* nothing */

  listOf<elem, sep>
    = nonemptyListOf<elem, sep>
    | emptyListOf<elem, sep>

  nonemptyListOf<elem, sep>
    = elem (sep elem)*

  emptyListOf<elem, sep>
    = /* nothing */

  // Allows a syntactic rule application within a lexical context.
  applySyntactic<app> = app
}`},"BuiltInRules",null,null,{alnum:["define",{sourceInterval:[18,78]},"an alpha-numeric character",[],["alt",{sourceInterval:[60,78]},["app",{sourceInterval:[60,66]},"letter",[]],["app",{sourceInterval:[73,78]},"digit",[]]]],letter:["define",{sourceInterval:[82,142]},"a letter",[],["alt",{sourceInterval:[107,142]},["app",{sourceInterval:[107,112]},"lower",[]],["app",{sourceInterval:[119,124]},"upper",[]],["app",{sourceInterval:[131,142]},"unicodeLtmo",[]]]],digit:["define",{sourceInterval:[146,177]},"a digit",[],["range",{sourceInterval:[169,177]},"0","9"]],hexDigit:["define",{sourceInterval:[181,254]},"a hexadecimal digit",[],["alt",{sourceInterval:[219,254]},["app",{sourceInterval:[219,224]},"digit",[]],["range",{sourceInterval:[231,239]},"a","f"],["range",{sourceInterval:[246,254]},"A","F"]]],ListOf:["define",{sourceInterval:[258,336]},null,["elem","sep"],["alt",{sourceInterval:[282,336]},["app",{sourceInterval:[282,307]},"NonemptyListOf",[["param",{sourceInterval:[297,301]},0],["param",{sourceInterval:[303,306]},1]]],["app",{sourceInterval:[314,336]},"EmptyListOf",[["param",{sourceInterval:[326,330]},0],["param",{sourceInterval:[332,335]},1]]]]],NonemptyListOf:["define",{sourceInterval:[340,388]},null,["elem","sep"],["seq",{sourceInterval:[372,388]},["param",{sourceInterval:[372,376]},0],["star",{sourceInterval:[377,388]},["seq",{sourceInterval:[378,386]},["param",{sourceInterval:[378,381]},1],["param",{sourceInterval:[382,386]},0]]]]],EmptyListOf:["define",{sourceInterval:[392,434]},null,["elem","sep"],["seq",{sourceInterval:[438,438]}]],listOf:["define",{sourceInterval:[438,516]},null,["elem","sep"],["alt",{sourceInterval:[462,516]},["app",{sourceInterval:[462,487]},"nonemptyListOf",[["param",{sourceInterval:[477,481]},0],["param",{sourceInterval:[483,486]},1]]],["app",{sourceInterval:[494,516]},"emptyListOf",[["param",{sourceInterval:[506,510]},0],["param",{sourceInterval:[512,515]},1]]]]],nonemptyListOf:["define",{sourceInterval:[520,568]},null,["elem","sep"],["seq",{sourceInterval:[552,568]},["param",{sourceInterval:[552,556]},0],["star",{sourceInterval:[557,568]},["seq",{sourceInterval:[558,566]},["param",{sourceInterval:[558,561]},1],["param",{sourceInterval:[562,566]},0]]]]],emptyListOf:["define",{sourceInterval:[572,682]},null,["elem","sep"],["seq",{sourceInterval:[685,685]}]],applySyntactic:["define",{sourceInterval:[685,710]},null,["app"],["param",{sourceInterval:[707,710]},0]]}]);J.BuiltInRules=Bt;Ti(J.BuiltInRules);const pn=ut(["grammar",{source:`Ohm {

  Grammars
    = Grammar*

  Grammar
    = ident SuperGrammar? "{" Rule* "}"

  SuperGrammar
    = "<:" ident

  Rule
    = ident Formals? ruleDescr? "="  RuleBody  -- define
    | ident Formals?            ":=" OverrideRuleBody  -- override
    | ident Formals?            "+=" RuleBody  -- extend

  RuleBody
    = "|"? NonemptyListOf<TopLevelTerm, "|">

  TopLevelTerm
    = Seq caseName  -- inline
    | Seq

  OverrideRuleBody
    = "|"? NonemptyListOf<OverrideTopLevelTerm, "|">

  OverrideTopLevelTerm
    = "..."  -- superSplice
    | TopLevelTerm

  Formals
    = "<" ListOf<ident, ","> ">"

  Params
    = "<" ListOf<Seq, ","> ">"

  Alt
    = NonemptyListOf<Seq, "|">

  Seq
    = Iter*

  Iter
    = Pred "*"  -- star
    | Pred "+"  -- plus
    | Pred "?"  -- opt
    | Pred

  Pred
    = "~" Lex  -- not
    | "&" Lex  -- lookahead
    | Lex

  Lex
    = "#" Base  -- lex
    | Base

  Base
    = ident Params? ~(ruleDescr? "=" | ":=" | "+=")  -- application
    | oneCharTerminal ".." oneCharTerminal           -- range
    | terminal                                       -- terminal
    | "(" Alt ")"                                    -- paren

  ruleDescr  (a rule description)
    = "(" ruleDescrText ")"

  ruleDescrText
    = (~")" any)*

  caseName
    = "--" (~"\\n" space)* name (~"\\n" space)* ("\\n" | &"}")

  name  (a name)
    = nameFirst nameRest*

  nameFirst
    = "_"
    | letter

  nameRest
    = "_"
    | alnum

  ident  (an identifier)
    = name

  terminal
    = "\\"" terminalChar* "\\""

  oneCharTerminal
    = "\\"" terminalChar "\\""

  terminalChar
    = escapeChar
      | ~"\\\\" ~"\\"" ~"\\n" "\\u{0}".."\\u{10FFFF}"

  escapeChar  (an escape sequence)
    = "\\\\\\\\"                                     -- backslash
    | "\\\\\\""                                     -- doubleQuote
    | "\\\\\\'"                                     -- singleQuote
    | "\\\\b"                                      -- backspace
    | "\\\\n"                                      -- lineFeed
    | "\\\\r"                                      -- carriageReturn
    | "\\\\t"                                      -- tab
    | "\\\\u{" hexDigit hexDigit? hexDigit?
             hexDigit? hexDigit? hexDigit? "}"   -- unicodeCodePoint
    | "\\\\u" hexDigit hexDigit hexDigit hexDigit  -- unicodeEscape
    | "\\\\x" hexDigit hexDigit                    -- hexEscape

  space
   += comment

  comment
    = "//" (~"\\n" any)* &("\\n" | end)  -- singleLine
    | "/*" (~"*/" any)* "*/"  -- multiLine

  tokens = token*

  token = caseName | comment | ident | operator | punctuation | terminal | any

  operator = "<:" | "=" | ":=" | "+=" | "*" | "+" | "?" | "~" | "&"

  punctuation = "<" | ">" | "," | "--"
}`},"Ohm",null,"Grammars",{Grammars:["define",{sourceInterval:[9,32]},null,[],["star",{sourceInterval:[24,32]},["app",{sourceInterval:[24,31]},"Grammar",[]]]],Grammar:["define",{sourceInterval:[36,83]},null,[],["seq",{sourceInterval:[50,83]},["app",{sourceInterval:[50,55]},"ident",[]],["opt",{sourceInterval:[56,69]},["app",{sourceInterval:[56,68]},"SuperGrammar",[]]],["terminal",{sourceInterval:[70,73]},"{"],["star",{sourceInterval:[74,79]},["app",{sourceInterval:[74,78]},"Rule",[]]],["terminal",{sourceInterval:[80,83]},"}"]]],SuperGrammar:["define",{sourceInterval:[87,116]},null,[],["seq",{sourceInterval:[106,116]},["terminal",{sourceInterval:[106,110]},"<:"],["app",{sourceInterval:[111,116]},"ident",[]]]],Rule_define:["define",{sourceInterval:[131,181]},null,[],["seq",{sourceInterval:[131,170]},["app",{sourceInterval:[131,136]},"ident",[]],["opt",{sourceInterval:[137,145]},["app",{sourceInterval:[137,144]},"Formals",[]]],["opt",{sourceInterval:[146,156]},["app",{sourceInterval:[146,155]},"ruleDescr",[]]],["terminal",{sourceInterval:[157,160]},"="],["app",{sourceInterval:[162,170]},"RuleBody",[]]]],Rule_override:["define",{sourceInterval:[188,248]},null,[],["seq",{sourceInterval:[188,235]},["app",{sourceInterval:[188,193]},"ident",[]],["opt",{sourceInterval:[194,202]},["app",{sourceInterval:[194,201]},"Formals",[]]],["terminal",{sourceInterval:[214,218]},":="],["app",{sourceInterval:[219,235]},"OverrideRuleBody",[]]]],Rule_extend:["define",{sourceInterval:[255,305]},null,[],["seq",{sourceInterval:[255,294]},["app",{sourceInterval:[255,260]},"ident",[]],["opt",{sourceInterval:[261,269]},["app",{sourceInterval:[261,268]},"Formals",[]]],["terminal",{sourceInterval:[281,285]},"+="],["app",{sourceInterval:[286,294]},"RuleBody",[]]]],Rule:["define",{sourceInterval:[120,305]},null,[],["alt",{sourceInterval:[131,305]},["app",{sourceInterval:[131,170]},"Rule_define",[]],["app",{sourceInterval:[188,235]},"Rule_override",[]],["app",{sourceInterval:[255,294]},"Rule_extend",[]]]],RuleBody:["define",{sourceInterval:[309,362]},null,[],["seq",{sourceInterval:[324,362]},["opt",{sourceInterval:[324,328]},["terminal",{sourceInterval:[324,327]},"|"]],["app",{sourceInterval:[329,362]},"NonemptyListOf",[["app",{sourceInterval:[344,356]},"TopLevelTerm",[]],["terminal",{sourceInterval:[358,361]},"|"]]]]],TopLevelTerm_inline:["define",{sourceInterval:[385,408]},null,[],["seq",{sourceInterval:[385,397]},["app",{sourceInterval:[385,388]},"Seq",[]],["app",{sourceInterval:[389,397]},"caseName",[]]]],TopLevelTerm:["define",{sourceInterval:[366,418]},null,[],["alt",{sourceInterval:[385,418]},["app",{sourceInterval:[385,397]},"TopLevelTerm_inline",[]],["app",{sourceInterval:[415,418]},"Seq",[]]]],OverrideRuleBody:["define",{sourceInterval:[422,491]},null,[],["seq",{sourceInterval:[445,491]},["opt",{sourceInterval:[445,449]},["terminal",{sourceInterval:[445,448]},"|"]],["app",{sourceInterval:[450,491]},"NonemptyListOf",[["app",{sourceInterval:[465,485]},"OverrideTopLevelTerm",[]],["terminal",{sourceInterval:[487,490]},"|"]]]]],OverrideTopLevelTerm_superSplice:["define",{sourceInterval:[522,543]},null,[],["terminal",{sourceInterval:[522,527]},"..."]],OverrideTopLevelTerm:["define",{sourceInterval:[495,562]},null,[],["alt",{sourceInterval:[522,562]},["app",{sourceInterval:[522,527]},"OverrideTopLevelTerm_superSplice",[]],["app",{sourceInterval:[550,562]},"TopLevelTerm",[]]]],Formals:["define",{sourceInterval:[566,606]},null,[],["seq",{sourceInterval:[580,606]},["terminal",{sourceInterval:[580,583]},"<"],["app",{sourceInterval:[584,602]},"ListOf",[["app",{sourceInterval:[591,596]},"ident",[]],["terminal",{sourceInterval:[598,601]},","]]],["terminal",{sourceInterval:[603,606]},">"]]],Params:["define",{sourceInterval:[610,647]},null,[],["seq",{sourceInterval:[623,647]},["terminal",{sourceInterval:[623,626]},"<"],["app",{sourceInterval:[627,643]},"ListOf",[["app",{sourceInterval:[634,637]},"Seq",[]],["terminal",{sourceInterval:[639,642]},","]]],["terminal",{sourceInterval:[644,647]},">"]]],Alt:["define",{sourceInterval:[651,685]},null,[],["app",{sourceInterval:[661,685]},"NonemptyListOf",[["app",{sourceInterval:[676,679]},"Seq",[]],["terminal",{sourceInterval:[681,684]},"|"]]]],Seq:["define",{sourceInterval:[689,704]},null,[],["star",{sourceInterval:[699,704]},["app",{sourceInterval:[699,703]},"Iter",[]]]],Iter_star:["define",{sourceInterval:[719,736]},null,[],["seq",{sourceInterval:[719,727]},["app",{sourceInterval:[719,723]},"Pred",[]],["terminal",{sourceInterval:[724,727]},"*"]]],Iter_plus:["define",{sourceInterval:[743,760]},null,[],["seq",{sourceInterval:[743,751]},["app",{sourceInterval:[743,747]},"Pred",[]],["terminal",{sourceInterval:[748,751]},"+"]]],Iter_opt:["define",{sourceInterval:[767,783]},null,[],["seq",{sourceInterval:[767,775]},["app",{sourceInterval:[767,771]},"Pred",[]],["terminal",{sourceInterval:[772,775]},"?"]]],Iter:["define",{sourceInterval:[708,794]},null,[],["alt",{sourceInterval:[719,794]},["app",{sourceInterval:[719,727]},"Iter_star",[]],["app",{sourceInterval:[743,751]},"Iter_plus",[]],["app",{sourceInterval:[767,775]},"Iter_opt",[]],["app",{sourceInterval:[790,794]},"Pred",[]]]],Pred_not:["define",{sourceInterval:[809,824]},null,[],["seq",{sourceInterval:[809,816]},["terminal",{sourceInterval:[809,812]},"~"],["app",{sourceInterval:[813,816]},"Lex",[]]]],Pred_lookahead:["define",{sourceInterval:[831,852]},null,[],["seq",{sourceInterval:[831,838]},["terminal",{sourceInterval:[831,834]},"&"],["app",{sourceInterval:[835,838]},"Lex",[]]]],Pred:["define",{sourceInterval:[798,862]},null,[],["alt",{sourceInterval:[809,862]},["app",{sourceInterval:[809,816]},"Pred_not",[]],["app",{sourceInterval:[831,838]},"Pred_lookahead",[]],["app",{sourceInterval:[859,862]},"Lex",[]]]],Lex_lex:["define",{sourceInterval:[876,892]},null,[],["seq",{sourceInterval:[876,884]},["terminal",{sourceInterval:[876,879]},"#"],["app",{sourceInterval:[880,884]},"Base",[]]]],Lex:["define",{sourceInterval:[866,903]},null,[],["alt",{sourceInterval:[876,903]},["app",{sourceInterval:[876,884]},"Lex_lex",[]],["app",{sourceInterval:[899,903]},"Base",[]]]],Base_application:["define",{sourceInterval:[918,979]},null,[],["seq",{sourceInterval:[918,963]},["app",{sourceInterval:[918,923]},"ident",[]],["opt",{sourceInterval:[924,931]},["app",{sourceInterval:[924,930]},"Params",[]]],["not",{sourceInterval:[932,963]},["alt",{sourceInterval:[934,962]},["seq",{sourceInterval:[934,948]},["opt",{sourceInterval:[934,944]},["app",{sourceInterval:[934,943]},"ruleDescr",[]]],["terminal",{sourceInterval:[945,948]},"="]],["terminal",{sourceInterval:[951,955]},":="],["terminal",{sourceInterval:[958,962]},"+="]]]]],Base_range:["define",{sourceInterval:[986,1041]},null,[],["seq",{sourceInterval:[986,1022]},["app",{sourceInterval:[986,1001]},"oneCharTerminal",[]],["terminal",{sourceInterval:[1002,1006]},".."],["app",{sourceInterval:[1007,1022]},"oneCharTerminal",[]]]],Base_terminal:["define",{sourceInterval:[1048,1106]},null,[],["app",{sourceInterval:[1048,1056]},"terminal",[]]],Base_paren:["define",{sourceInterval:[1113,1168]},null,[],["seq",{sourceInterval:[1113,1124]},["terminal",{sourceInterval:[1113,1116]},"("],["app",{sourceInterval:[1117,1120]},"Alt",[]],["terminal",{sourceInterval:[1121,1124]},")"]]],Base:["define",{sourceInterval:[907,1168]},null,[],["alt",{sourceInterval:[918,1168]},["app",{sourceInterval:[918,963]},"Base_application",[]],["app",{sourceInterval:[986,1022]},"Base_range",[]],["app",{sourceInterval:[1048,1056]},"Base_terminal",[]],["app",{sourceInterval:[1113,1124]},"Base_paren",[]]]],ruleDescr:["define",{sourceInterval:[1172,1231]},"a rule description",[],["seq",{sourceInterval:[1210,1231]},["terminal",{sourceInterval:[1210,1213]},"("],["app",{sourceInterval:[1214,1227]},"ruleDescrText",[]],["terminal",{sourceInterval:[1228,1231]},")"]]],ruleDescrText:["define",{sourceInterval:[1235,1266]},null,[],["star",{sourceInterval:[1255,1266]},["seq",{sourceInterval:[1256,1264]},["not",{sourceInterval:[1256,1260]},["terminal",{sourceInterval:[1257,1260]},")"]],["app",{sourceInterval:[1261,1264]},"any",[]]]]],caseName:["define",{sourceInterval:[1270,1338]},null,[],["seq",{sourceInterval:[1285,1338]},["terminal",{sourceInterval:[1285,1289]},"--"],["star",{sourceInterval:[1290,1304]},["seq",{sourceInterval:[1291,1302]},["not",{sourceInterval:[1291,1296]},["terminal",{sourceInterval:[1292,1296]},`
`]],["app",{sourceInterval:[1297,1302]},"space",[]]]],["app",{sourceInterval:[1305,1309]},"name",[]],["star",{sourceInterval:[1310,1324]},["seq",{sourceInterval:[1311,1322]},["not",{sourceInterval:[1311,1316]},["terminal",{sourceInterval:[1312,1316]},`
`]],["app",{sourceInterval:[1317,1322]},"space",[]]]],["alt",{sourceInterval:[1326,1337]},["terminal",{sourceInterval:[1326,1330]},`
`],["lookahead",{sourceInterval:[1333,1337]},["terminal",{sourceInterval:[1334,1337]},"}"]]]]],name:["define",{sourceInterval:[1342,1382]},"a name",[],["seq",{sourceInterval:[1363,1382]},["app",{sourceInterval:[1363,1372]},"nameFirst",[]],["star",{sourceInterval:[1373,1382]},["app",{sourceInterval:[1373,1381]},"nameRest",[]]]]],nameFirst:["define",{sourceInterval:[1386,1418]},null,[],["alt",{sourceInterval:[1402,1418]},["terminal",{sourceInterval:[1402,1405]},"_"],["app",{sourceInterval:[1412,1418]},"letter",[]]]],nameRest:["define",{sourceInterval:[1422,1452]},null,[],["alt",{sourceInterval:[1437,1452]},["terminal",{sourceInterval:[1437,1440]},"_"],["app",{sourceInterval:[1447,1452]},"alnum",[]]]],ident:["define",{sourceInterval:[1456,1489]},"an identifier",[],["app",{sourceInterval:[1485,1489]},"name",[]]],terminal:["define",{sourceInterval:[1493,1531]},null,[],["seq",{sourceInterval:[1508,1531]},["terminal",{sourceInterval:[1508,1512]},'"'],["star",{sourceInterval:[1513,1526]},["app",{sourceInterval:[1513,1525]},"terminalChar",[]]],["terminal",{sourceInterval:[1527,1531]},'"']]],oneCharTerminal:["define",{sourceInterval:[1535,1579]},null,[],["seq",{sourceInterval:[1557,1579]},["terminal",{sourceInterval:[1557,1561]},'"'],["app",{sourceInterval:[1562,1574]},"terminalChar",[]],["terminal",{sourceInterval:[1575,1579]},'"']]],terminalChar:["define",{sourceInterval:[1583,1660]},null,[],["alt",{sourceInterval:[1602,1660]},["app",{sourceInterval:[1602,1612]},"escapeChar",[]],["seq",{sourceInterval:[1621,1660]},["not",{sourceInterval:[1621,1626]},["terminal",{sourceInterval:[1622,1626]},"\\"]],["not",{sourceInterval:[1627,1632]},["terminal",{sourceInterval:[1628,1632]},'"']],["not",{sourceInterval:[1633,1638]},["terminal",{sourceInterval:[1634,1638]},`
`]],["range",{sourceInterval:[1639,1660]},"\0","􏿿"]]]],escapeChar_backslash:["define",{sourceInterval:[1703,1758]},null,[],["terminal",{sourceInterval:[1703,1709]},"\\\\"]],escapeChar_doubleQuote:["define",{sourceInterval:[1765,1822]},null,[],["terminal",{sourceInterval:[1765,1771]},'\\"']],escapeChar_singleQuote:["define",{sourceInterval:[1829,1886]},null,[],["terminal",{sourceInterval:[1829,1835]},"\\'"]],escapeChar_backspace:["define",{sourceInterval:[1893,1948]},null,[],["terminal",{sourceInterval:[1893,1898]},"\\b"]],escapeChar_lineFeed:["define",{sourceInterval:[1955,2009]},null,[],["terminal",{sourceInterval:[1955,1960]},"\\n"]],escapeChar_carriageReturn:["define",{sourceInterval:[2016,2076]},null,[],["terminal",{sourceInterval:[2016,2021]},"\\r"]],escapeChar_tab:["define",{sourceInterval:[2083,2132]},null,[],["terminal",{sourceInterval:[2083,2088]},"\\t"]],escapeChar_unicodeCodePoint:["define",{sourceInterval:[2139,2243]},null,[],["seq",{sourceInterval:[2139,2221]},["terminal",{sourceInterval:[2139,2145]},"\\u{"],["app",{sourceInterval:[2146,2154]},"hexDigit",[]],["opt",{sourceInterval:[2155,2164]},["app",{sourceInterval:[2155,2163]},"hexDigit",[]]],["opt",{sourceInterval:[2165,2174]},["app",{sourceInterval:[2165,2173]},"hexDigit",[]]],["opt",{sourceInterval:[2188,2197]},["app",{sourceInterval:[2188,2196]},"hexDigit",[]]],["opt",{sourceInterval:[2198,2207]},["app",{sourceInterval:[2198,2206]},"hexDigit",[]]],["opt",{sourceInterval:[2208,2217]},["app",{sourceInterval:[2208,2216]},"hexDigit",[]]],["terminal",{sourceInterval:[2218,2221]},"}"]]],escapeChar_unicodeEscape:["define",{sourceInterval:[2250,2309]},null,[],["seq",{sourceInterval:[2250,2291]},["terminal",{sourceInterval:[2250,2255]},"\\u"],["app",{sourceInterval:[2256,2264]},"hexDigit",[]],["app",{sourceInterval:[2265,2273]},"hexDigit",[]],["app",{sourceInterval:[2274,2282]},"hexDigit",[]],["app",{sourceInterval:[2283,2291]},"hexDigit",[]]]],escapeChar_hexEscape:["define",{sourceInterval:[2316,2371]},null,[],["seq",{sourceInterval:[2316,2339]},["terminal",{sourceInterval:[2316,2321]},"\\x"],["app",{sourceInterval:[2322,2330]},"hexDigit",[]],["app",{sourceInterval:[2331,2339]},"hexDigit",[]]]],escapeChar:["define",{sourceInterval:[1664,2371]},"an escape sequence",[],["alt",{sourceInterval:[1703,2371]},["app",{sourceInterval:[1703,1709]},"escapeChar_backslash",[]],["app",{sourceInterval:[1765,1771]},"escapeChar_doubleQuote",[]],["app",{sourceInterval:[1829,1835]},"escapeChar_singleQuote",[]],["app",{sourceInterval:[1893,1898]},"escapeChar_backspace",[]],["app",{sourceInterval:[1955,1960]},"escapeChar_lineFeed",[]],["app",{sourceInterval:[2016,2021]},"escapeChar_carriageReturn",[]],["app",{sourceInterval:[2083,2088]},"escapeChar_tab",[]],["app",{sourceInterval:[2139,2221]},"escapeChar_unicodeCodePoint",[]],["app",{sourceInterval:[2250,2291]},"escapeChar_unicodeEscape",[]],["app",{sourceInterval:[2316,2339]},"escapeChar_hexEscape",[]]]],space:["extend",{sourceInterval:[2375,2394]},null,[],["app",{sourceInterval:[2387,2394]},"comment",[]]],comment_singleLine:["define",{sourceInterval:[2412,2458]},null,[],["seq",{sourceInterval:[2412,2443]},["terminal",{sourceInterval:[2412,2416]},"//"],["star",{sourceInterval:[2417,2429]},["seq",{sourceInterval:[2418,2427]},["not",{sourceInterval:[2418,2423]},["terminal",{sourceInterval:[2419,2423]},`
`]],["app",{sourceInterval:[2424,2427]},"any",[]]]],["lookahead",{sourceInterval:[2430,2443]},["alt",{sourceInterval:[2432,2442]},["terminal",{sourceInterval:[2432,2436]},`
`],["app",{sourceInterval:[2439,2442]},"end",[]]]]]],comment_multiLine:["define",{sourceInterval:[2465,2501]},null,[],["seq",{sourceInterval:[2465,2487]},["terminal",{sourceInterval:[2465,2469]},"/*"],["star",{sourceInterval:[2470,2482]},["seq",{sourceInterval:[2471,2480]},["not",{sourceInterval:[2471,2476]},["terminal",{sourceInterval:[2472,2476]},"*/"]],["app",{sourceInterval:[2477,2480]},"any",[]]]],["terminal",{sourceInterval:[2483,2487]},"*/"]]],comment:["define",{sourceInterval:[2398,2501]},null,[],["alt",{sourceInterval:[2412,2501]},["app",{sourceInterval:[2412,2443]},"comment_singleLine",[]],["app",{sourceInterval:[2465,2487]},"comment_multiLine",[]]]],tokens:["define",{sourceInterval:[2505,2520]},null,[],["star",{sourceInterval:[2514,2520]},["app",{sourceInterval:[2514,2519]},"token",[]]]],token:["define",{sourceInterval:[2524,2600]},null,[],["alt",{sourceInterval:[2532,2600]},["app",{sourceInterval:[2532,2540]},"caseName",[]],["app",{sourceInterval:[2543,2550]},"comment",[]],["app",{sourceInterval:[2553,2558]},"ident",[]],["app",{sourceInterval:[2561,2569]},"operator",[]],["app",{sourceInterval:[2572,2583]},"punctuation",[]],["app",{sourceInterval:[2586,2594]},"terminal",[]],["app",{sourceInterval:[2597,2600]},"any",[]]]],operator:["define",{sourceInterval:[2604,2669]},null,[],["alt",{sourceInterval:[2615,2669]},["terminal",{sourceInterval:[2615,2619]},"<:"],["terminal",{sourceInterval:[2622,2625]},"="],["terminal",{sourceInterval:[2628,2632]},":="],["terminal",{sourceInterval:[2635,2639]},"+="],["terminal",{sourceInterval:[2642,2645]},"*"],["terminal",{sourceInterval:[2648,2651]},"+"],["terminal",{sourceInterval:[2654,2657]},"?"],["terminal",{sourceInterval:[2660,2663]},"~"],["terminal",{sourceInterval:[2666,2669]},"&"]]],punctuation:["define",{sourceInterval:[2673,2709]},null,[],["alt",{sourceInterval:[2687,2709]},["terminal",{sourceInterval:[2687,2690]},"<"],["terminal",{sourceInterval:[2693,2696]},">"],["terminal",{sourceInterval:[2699,2702]},","],["terminal",{sourceInterval:[2705,2709]},"--"]]]}]),dt=Object.create(I.prototype);function dr(t,e){for(const r in t)if(r===e)return!0;return!1}function Zi(t,e,r){const n=new tt;let i,s,o,a=!1;return(r||pn).createSemantics().addOperation("visit",{Grammars(c){return c.children.map(u=>u.visit())},Grammar(c,u,h,m,d){const g=c.visit();i=n.newGrammar(g),u.child(0)&&u.child(0).visit(),m.children.map(v=>v.visit());const f=i.build();if(f.source=this.source.trimmed(),dr(e,g))throw Ii(f);return e[g]=f,f},SuperGrammar(c,u){const h=u.visit();if(h==="null")i.withSuperGrammar(null);else{if(!e||!dr(e,h))throw vi(h,e,u.source);i.withSuperGrammar(e[h])}},Rule_define(c,u,h,m,d){s=c.visit(),o=u.children.map(_=>_.visit())[0]||[],!i.defaultStartRule&&i.ensureSuperGrammar()!==J.ProtoBuiltInRules&&i.withDefaultStartRule(s);const g=d.visit(),f=h.children.map(_=>_.visit())[0],v=this.source.trimmed();return i.define(s,o,g,f,v)},Rule_override(c,u,h,m){s=c.visit(),o=u.children.map(f=>f.visit())[0]||[];const d=this.source.trimmed();i.ensureSuperGrammarRuleForOverriding(s,d),a=!0;const g=m.visit();return a=!1,i.override(s,o,g,null,d)},Rule_extend(c,u,h,m){s=c.visit(),o=u.children.map(f=>f.visit())[0]||[];const d=m.visit(),g=this.source.trimmed();return i.extend(s,o,d,null,g)},RuleBody(c,u){return n.alt(...u.visit()).withSource(this.source)},OverrideRuleBody(c,u){const h=u.visit(),m=h.indexOf(dt);if(m>=0){const d=h.slice(0,m),g=h.slice(m+1);return g.forEach(f=>{if(f===dt)throw Oi(f)}),new at(i.superGrammar,s,d,g).withSource(this.source)}else return n.alt(...h).withSource(this.source)},Formals(c,u,h){return u.visit()},Params(c,u,h){return u.visit()},Alt(c){return n.alt(...c.visit()).withSource(this.source)},TopLevelTerm_inline(c,u){const h=s+"_"+u.visit(),m=c.visit(),d=this.source.trimmed(),g=!(i.superGrammar&&i.superGrammar.rules[h]);a&&!g?i.override(h,o,m,null,d):i.define(h,o,m,null,d);const f=o.map(v=>n.app(v));return n.app(h,f).withSource(m.source)},OverrideTopLevelTerm_superSplice(c){return dt},Seq(c){return n.seq(...c.children.map(u=>u.visit())).withSource(this.source)},Iter_star(c,u){return n.star(c.visit()).withSource(this.source)},Iter_plus(c,u){return n.plus(c.visit()).withSource(this.source)},Iter_opt(c,u){return n.opt(c.visit()).withSource(this.source)},Pred_not(c,u){return n.not(u.visit()).withSource(this.source)},Pred_lookahead(c,u){return n.lookahead(u.visit()).withSource(this.source)},Lex_lex(c,u){return n.lex(u.visit()).withSource(this.source)},Base_application(c,u){const h=u.children.map(m=>m.visit())[0]||[];return n.app(c.visit(),h).withSource(this.source)},Base_range(c,u,h){return n.range(c.visit(),h.visit()).withSource(this.source)},Base_terminal(c){return n.terminal(c.visit()).withSource(this.source)},Base_paren(c,u,h){return u.visit()},ruleDescr(c,u,h){return u.visit()},ruleDescrText(c){return this.sourceString.trim()},caseName(c,u,h,m,d){return h.visit()},name(c,u){return this.sourceString},nameFirst(c){},nameRest(c){},terminal(c,u,h){return u.children.map(m=>m.visit()).join("")},oneCharTerminal(c,u,h){return u.visit()},escapeChar(c){try{return jr(this.sourceString)}catch(u){throw u instanceof RangeError&&u.message.startsWith("Invalid code point ")?Li(c):u}},NonemptyListOf(c,u,h){return[c.visit()].concat(h.children.map(m=>m.visit()))},EmptyListOf(){return[]},_terminal(){return this.sourceString}})(t).visit()}const es=ut(["grammar",{source:`OperationsAndAttributes {

  AttributeSignature =
    name

  OperationSignature =
    name Formals?

  Formals
    = "(" ListOf<name, ","> ")"

  name  (a name)
    = nameFirst nameRest*

  nameFirst
    = "_"
    | letter

  nameRest
    = "_"
    | alnum

}`},"OperationsAndAttributes",null,"AttributeSignature",{AttributeSignature:["define",{sourceInterval:[29,58]},null,[],["app",{sourceInterval:[54,58]},"name",[]]],OperationSignature:["define",{sourceInterval:[62,100]},null,[],["seq",{sourceInterval:[87,100]},["app",{sourceInterval:[87,91]},"name",[]],["opt",{sourceInterval:[92,100]},["app",{sourceInterval:[92,99]},"Formals",[]]]]],Formals:["define",{sourceInterval:[104,143]},null,[],["seq",{sourceInterval:[118,143]},["terminal",{sourceInterval:[118,121]},"("],["app",{sourceInterval:[122,139]},"ListOf",[["app",{sourceInterval:[129,133]},"name",[]],["terminal",{sourceInterval:[135,138]},","]]],["terminal",{sourceInterval:[140,143]},")"]]],name:["define",{sourceInterval:[147,187]},"a name",[],["seq",{sourceInterval:[168,187]},["app",{sourceInterval:[168,177]},"nameFirst",[]],["star",{sourceInterval:[178,187]},["app",{sourceInterval:[178,186]},"nameRest",[]]]]],nameFirst:["define",{sourceInterval:[191,223]},null,[],["alt",{sourceInterval:[207,223]},["terminal",{sourceInterval:[207,210]},"_"],["app",{sourceInterval:[217,223]},"letter",[]]]],nameRest:["define",{sourceInterval:[227,257]},null,[],["alt",{sourceInterval:[242,257]},["terminal",{sourceInterval:[242,245]},"_"],["app",{sourceInterval:[252,257]},"alnum",[]]]]}]);ts(J.BuiltInRules);rs(es);function ts(t){const e={empty(){return this.iteration()},nonEmpty(r,n,i){return this.iteration([r].concat(i.children))}};ee.BuiltInSemantics=ee.createSemantics(t,null).addOperation("asIteration",{emptyListOf:e.empty,nonemptyListOf:e.nonEmpty,EmptyListOf:e.empty,NonemptyListOf:e.nonEmpty})}function rs(t){ee.prototypeGrammarSemantics=t.createSemantics().addOperation("parse",{AttributeSignature(e){return{name:e.parse(),formals:[]}},OperationSignature(e,r){return{name:e.parse(),formals:r.children.map(n=>n.parse())[0]||[]}},Formals(e,r,n){return r.asIteration().children.map(i=>i.parse())},name(e,r){return this.sourceString}}),ee.prototypeGrammar=t}function ns(t){let e=0;const r=[0],n=()=>r[r.length-1],i={},s=/( *).*(?:$|\r?\n|\r)/g;let o;for(;(o=s.exec(t))!=null;){const[a,l]=o;if(a.length===0)break;const p=l.length,c=n(),u=e+p;if(p>c)r.push(p),i[u]=1;else if(p<c){const h=r.length;for(;n()!==p;)r.pop();i[u]=-1*(h-r.length)}e+=a.length}return r.length>1&&(i[e]=1-r.length),i}const hn="an indented block",fn="a dedent",gr=1114112;class is extends lt{constructor(e){super(e.input),this.state=e}_indentationAt(e){return this.state.userData[e]||0}atEnd(){return super.atEnd()&&this._indentationAt(this.pos)===0}next(){if(this._indentationAt(this.pos)!==0){this.examinedLength=Math.max(this.examinedLength,this.pos);return}return super.next()}nextCharCode(){return this._indentationAt(this.pos)!==0?(this.examinedLength=Math.max(this.examinedLength,this.pos),gr):super.nextCharCode()}nextCodePoint(){return this._indentationAt(this.pos)!==0?(this.examinedLength=Math.max(this.examinedLength,this.pos),gr):super.nextCodePoint()}}class vr extends I{constructor(e=!0){super(),this.isIndent=e}allowsSkippingPrecedingSpace(){return!0}eval(e){const{inputStream:r}=e,n=e.userData;e.doNotMemoize=!0;const i=r.pos,s=this.isIndent?1:-1;return(n[i]||0)*s>0?(e.userData=Object.create(n),e.userData[i]-=s,e.pushBinding(new Ne(0),i),!0):(e.processFailure(i,this),!1)}getArity(){return 1}_assertAllApplicationsAreValid(e,r){}_isNullable(e,r){return!1}assertChoicesHaveUniformArity(e){}assertIteratedExprsAreNotNullable(e){}introduceParams(e){return this}substituteParams(e){return this}toString(){return this.isIndent?"indent":"dedent"}toDisplayString(){return this.toString()}toFailure(e){const r=this.isIndent?hn:fn;return new ie(this,r,"description")}}const ss=new x("indent"),os=new x("dedent"),as=new at(Bt,"any",[ss,os],[]),ls=new tt().newGrammar("IndentationSensitive").withSuperGrammar(Bt).define("indent",[],new vr(!0),hn,void 0,!0).define("dedent",[],new vr(!1),fn,void 0,!0).extend("any",[],as,"any character",void 0).build();Object.assign(ls,{_matchStateInitializer(t){t.userData=ns(t.input),t.inputStream=new is(t)},supportsIncrementalParsing:!1});J.initApplicationParser(pn,Zi);const Ir=ut(["grammar",{source:`Rolls {
	Rolls
        = Roll? (#("," | " ") Roll)*
    
    Roll
    	= ArithmeticRoll | MinMaxRoll | advantageRoll | SignedRoll | diceRoll | LiteralRoll
    
    MinMaxRoll
    	= (caseInsensitive<"min"> | caseInsensitive<"max">) "(" Rolls ")"
    
    ArithmeticRoll
    	= Roll operator Roll
        
    SignedRoll
    	= operator Roll
        
    LiteralRoll
    	= integer

    integer
        = digit+
    
    operator
    	= "-" | "+"
        
    diceRoll
    	= integer? caseInsensitive<"d"> integer
    
    advantageRoll
    	= diceRoll (caseInsensitive<"a"> | caseInsensitive<"d">)
}`},"Rolls",null,"Rolls",{Rolls:["define",{sourceInterval:[9,51]},null,[],["seq",{sourceInterval:[25,51]},["opt",{sourceInterval:[25,30]},["app",{sourceInterval:[25,29]},"Roll",[]]],["star",{sourceInterval:[31,51]},["seq",{sourceInterval:[32,49]},["lex",{sourceInterval:[32,44]},["alt",{sourceInterval:[34,43]},["terminal",{sourceInterval:[34,37]},","],["terminal",{sourceInterval:[40,43]}," "]]],["app",{sourceInterval:[45,49]},"Roll",[]]]]]],Roll:["define",{sourceInterval:[61,154]},null,[],["alt",{sourceInterval:[73,154]},["app",{sourceInterval:[73,87]},"ArithmeticRoll",[]],["app",{sourceInterval:[90,100]},"MinMaxRoll",[]],["app",{sourceInterval:[103,116]},"advantageRoll",[]],["app",{sourceInterval:[119,129]},"SignedRoll",[]],["app",{sourceInterval:[132,140]},"diceRoll",[]],["app",{sourceInterval:[143,154]},"LiteralRoll",[]]]],MinMaxRoll:["define",{sourceInterval:[164,245]},null,[],["seq",{sourceInterval:[182,245]},["alt",{sourceInterval:[183,230]},["app",{sourceInterval:[183,205]},"caseInsensitive",[["terminal",{sourceInterval:[199,204]},"min"]]],["app",{sourceInterval:[208,230]},"caseInsensitive",[["terminal",{sourceInterval:[224,229]},"max"]]]],["terminal",{sourceInterval:[232,235]},"("],["app",{sourceInterval:[236,241]},"Rolls",[]],["terminal",{sourceInterval:[242,245]},")"]]],ArithmeticRoll:["define",{sourceInterval:[255,295]},null,[],["seq",{sourceInterval:[277,295]},["app",{sourceInterval:[277,281]},"Roll",[]],["app",{sourceInterval:[282,290]},"operator",[]],["app",{sourceInterval:[291,295]},"Roll",[]]]],SignedRoll:["define",{sourceInterval:[309,340]},null,[],["seq",{sourceInterval:[327,340]},["app",{sourceInterval:[327,335]},"operator",[]],["app",{sourceInterval:[336,340]},"Roll",[]]]],LiteralRoll:["define",{sourceInterval:[354,380]},null,[],["app",{sourceInterval:[373,380]},"integer",[]]],integer:["define",{sourceInterval:[386,410]},null,[],["plus",{sourceInterval:[404,410]},["app",{sourceInterval:[404,409]},"digit",[]]]],operator:["define",{sourceInterval:[420,445]},null,[],["alt",{sourceInterval:[436,445]},["terminal",{sourceInterval:[436,439]},"-"],["terminal",{sourceInterval:[442,445]},"+"]]],diceRoll:["define",{sourceInterval:[459,512]},null,[],["seq",{sourceInterval:[475,512]},["opt",{sourceInterval:[475,483]},["app",{sourceInterval:[475,482]},"integer",[]]],["app",{sourceInterval:[484,504]},"caseInsensitive",[["terminal",{sourceInterval:[500,503]},"d"]]],["app",{sourceInterval:[505,512]},"integer",[]]]],advantageRoll:["define",{sourceInterval:[522,597]},null,[],["seq",{sourceInterval:[543,597]},["app",{sourceInterval:[543,551]},"diceRoll",[]],["alt",{sourceInterval:[553,596]},["app",{sourceInterval:[553,573]},"caseInsensitive",[["terminal",{sourceInterval:[569,572]},"a"]]],["app",{sourceInterval:[576,596]},"caseInsensitive",[["terminal",{sourceInterval:[592,595]},"d"]]]]]]}]);var mn=(t=>(t.MIN="MIN",t.MAX="MAX",t.ADD="ADD",t.SUB="SUB",t))(mn||{});function me(t){return typeof t=="object"&&!!t.mode}function Gt(t){return me(t)&&["ADD","SUB"].includes(t.mode)}function us(t){return me(t)&&["MIN","MAX"].includes(t.mode)}function pe(t){return typeof t=="object"&&Array.isArray(t.results)}function cs(t){return me(t)?t.rolls.every(e=>cs(e)):pe(t)?t.results.length===0:t===0}function de(t,e){return me(t)?t.mode==="ADD"?de(t.rolls[0])+de(t.rolls[1]):t.mode==="SUB"?de(t.rolls[0])-de(t.rolls[1]):t.mode==="MIN"?Math.min(de(t.rolls[0]),de(t.rolls[1])):Math.max(de(t.rolls[0]),de(t.rolls[1])):pe(t)?t.results.reduce((r,n)=>n+r,0):t}function ps(t){if(me(t))for(const e of t.rolls)ps(e);else pe(t)&&(t.results=t.results.map(e=>hs(t.sides)));return t}function hs(t){return Math.ceil(Math.random()*t)}function yr(t){return me(t)?t.mode==="MIN"?t.rolls.every(e=>yr(e)):t.rolls.some(e=>yr(e)):pe(t)?t.sides===20&&t.results.some(e=>e===20):!1}function qt(t){if(me(t)){if(t={...t,rolls:t.rolls.map(e=>qt(e))},t.mode==="ADD"){if(t.rolls.every(e=>pe(e))){const e=t.rolls;if(e[0].sides===e[1].sides)return{sides:e[0].sides,results:e.map(r=>r.results).flat(1)}}else if(t.rolls.every(e=>typeof e=="number")){const e=t.rolls;return e[0]+e[1]}}else if(t.mode==="SUB"&&t.rolls.every(e=>typeof e=="number")){const e=t.rolls;return e[0]-e[1]}}else if(pe(t)){if(t.sides===1)return t.results.length;if(t.sides===0)return t.results.reduce((e,r)=>e+r,0)}return t}class fs extends Error{constructor(e){super(e)}}function dn(t,e){if(e.length<2)throw new Error(">=2 rolls needed to create binary roll.");return{mode:t,rolls:[e[0],e.length>2?dn(t,e.slice(1)):e[1]]}}function gn(t,e="ADD"){return Gt(t)&&(t.rolls=t.rolls.map(r=>gn(r,t.mode)),e==="SUB"&&(t.mode=t.mode==="ADD"?"SUB":"ADD")),t}function va(t){const e=Ir.createSemantics();e.addAttribute("integer",{integer(i){return Number(i.sourceString)}}),e.addAttribute("operator",{operator(i){return i.sourceString}}),e.addAttribute("roll",{LiteralRoll(i){return i.integer},diceRoll(i,s,o){var p,c;const a=o.integer,l=((c=(p=i.children)==null?void 0:p[0])==null?void 0:c.integer)??1;return{sides:a,results:[...new Array(l)].fill(0)}},SignedRoll(i,s){return i.operator==="+"?s.roll:{mode:"SUB",rolls:[0,s.roll]}},advantageRoll(i,s){return{mode:s.sourceString==="a"?"MAX":"MIN",rolls:[{...i.roll},{...i.roll}]}},MinMaxRoll(i,s,o,a){return o.children.length===0?0:o.children.length===1?o.children[0].roll:dn(i.sourceString.toLocaleLowerCase()==="min"?"MIN":"MAX",o.rolls)},ArithmeticRoll(i,s,o){return{mode:s.operator==="+"?"ADD":"SUB",rolls:[i.roll,o.roll]}}}),e.addAttribute("rolls",{Rolls(i,s,o){var a,l;return[(l=(a=i.children)==null?void 0:a[0])==null?void 0:l.roll,...o.children.map(p=>p.roll)].filter(p=>!!p)}});const r=Ir.match(t,"Rolls");if(!r.succeeded())throw new fs(r.shortMessage??"Failed to parse roll spec.");let n=e(r).rolls;return n=n.map(i=>qt(i)),n=n.map(i=>gn(i)),n}function ms(t){return me(t)?{...t,rolls:t.rolls.map(e=>ms(e))}:pe(t)?{...t,results:t.results}:t}var vn="1.13.7",_r=typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global||Function("return this")()||{},ct=Array.prototype,$t=Object.prototype,Sr=typeof Symbol<"u"?Symbol.prototype:null,ds=ct.push,We=ct.slice,qe=$t.toString,gs=$t.hasOwnProperty,In=typeof ArrayBuffer<"u",vs=typeof DataView<"u",Is=Array.isArray,Ar=Object.keys,wr=Object.create,xr=In&&ArrayBuffer.isView,ys=isNaN,_s=isFinite,yn=!{toString:null}.propertyIsEnumerable("toString"),Nr=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],Ss=Math.pow(2,53)-1;function te(t,e){return e=e==null?t.length-1:+e,function(){for(var r=Math.max(arguments.length-e,0),n=Array(r),i=0;i<r;i++)n[i]=arguments[i+e];switch(e){case 0:return t.call(this,n);case 1:return t.call(this,arguments[0],n);case 2:return t.call(this,arguments[0],arguments[1],n)}var s=Array(e+1);for(i=0;i<e;i++)s[i]=arguments[i];return s[e]=n,t.apply(this,s)}}function Re(t){var e=typeof t;return e==="function"||e==="object"&&!!t}function As(t){return t===null}function _n(t){return t===void 0}function Sn(t){return t===!0||t===!1||qe.call(t)==="[object Boolean]"}function ws(t){return!!(t&&t.nodeType===1)}function W(t){var e="[object "+t+"]";return function(r){return qe.call(r)===e}}const Ut=W("String"),An=W("Number"),xs=W("Date"),Ns=W("RegExp"),Rs=W("Error"),wn=W("Symbol"),xn=W("ArrayBuffer");var Nn=W("Function"),bs=_r.document&&_r.document.childNodes;typeof/./!="function"&&typeof Int8Array!="object"&&typeof bs!="function"&&(Nn=function(t){return typeof t=="function"||!1});const X=Nn,Rn=W("Object");var bn=vs&&(!/\[native code\]/.test(String(DataView))||Rn(new DataView(new ArrayBuffer(8)))),zt=typeof Map<"u"&&Rn(new Map),Os=W("DataView");function Ls(t){return t!=null&&X(t.getInt8)&&xn(t.buffer)}const rt=bn?Ls:Os,be=Is||W("Array");function Ie(t,e){return t!=null&&gs.call(t,e)}var Rt=W("Arguments");(function(){Rt(arguments)||(Rt=function(t){return Ie(t,"callee")})})();const Vt=Rt;function Ps(t){return!wn(t)&&_s(t)&&!isNaN(parseFloat(t))}function On(t){return An(t)&&ys(t)}function Ln(t){return function(){return t}}function Pn(t){return function(e){var r=t(e);return typeof r=="number"&&r>=0&&r<=Ss}}function En(t){return function(e){return e==null?void 0:e[t]}}const nt=En("byteLength"),Es=Pn(nt);var Fs=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/;function Ds(t){return xr?xr(t)&&!rt(t):Es(t)&&Fs.test(qe.call(t))}const Fn=In?Ds:Ln(!1),re=En("length");function Cs(t){for(var e={},r=t.length,n=0;n<r;++n)e[t[n]]=!0;return{contains:function(i){return e[i]===!0},push:function(i){return e[i]=!0,t.push(i)}}}function Dn(t,e){e=Cs(e);var r=Nr.length,n=t.constructor,i=X(n)&&n.prototype||$t,s="constructor";for(Ie(t,s)&&!e.contains(s)&&e.push(s);r--;)s=Nr[r],s in t&&t[s]!==i[s]&&!e.contains(s)&&e.push(s)}function M(t){if(!Re(t))return[];if(Ar)return Ar(t);var e=[];for(var r in t)Ie(t,r)&&e.push(r);return yn&&Dn(t,e),e}function Ts(t){if(t==null)return!0;var e=re(t);return typeof e=="number"&&(be(t)||Ut(t)||Vt(t))?e===0:re(M(t))===0}function Cn(t,e){var r=M(e),n=r.length;if(t==null)return!n;for(var i=Object(t),s=0;s<n;s++){var o=r[s];if(e[o]!==i[o]||!(o in i))return!1}return!0}function A(t){if(t instanceof A)return t;if(!(this instanceof A))return new A(t);this._wrapped=t}A.VERSION=vn;A.prototype.value=function(){return this._wrapped};A.prototype.valueOf=A.prototype.toJSON=A.prototype.value;A.prototype.toString=function(){return String(this._wrapped)};function Rr(t){return new Uint8Array(t.buffer||t,t.byteOffset||0,nt(t))}var br="[object DataView]";function bt(t,e,r,n){if(t===e)return t!==0||1/t===1/e;if(t==null||e==null)return!1;if(t!==t)return e!==e;var i=typeof t;return i!=="function"&&i!=="object"&&typeof e!="object"?!1:Tn(t,e,r,n)}function Tn(t,e,r,n){t instanceof A&&(t=t._wrapped),e instanceof A&&(e=e._wrapped);var i=qe.call(t);if(i!==qe.call(e))return!1;if(bn&&i=="[object Object]"&&rt(t)){if(!rt(e))return!1;i=br}switch(i){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!=+t?+e!=+e:+t==0?1/+t===1/e:+t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object Symbol]":return Sr.valueOf.call(t)===Sr.valueOf.call(e);case"[object ArrayBuffer]":case br:return Tn(Rr(t),Rr(e),r,n)}var s=i==="[object Array]";if(!s&&Fn(t)){var o=nt(t);if(o!==nt(e))return!1;if(t.buffer===e.buffer&&t.byteOffset===e.byteOffset)return!0;s=!0}if(!s){if(typeof t!="object"||typeof e!="object")return!1;var a=t.constructor,l=e.constructor;if(a!==l&&!(X(a)&&a instanceof a&&X(l)&&l instanceof l)&&"constructor"in t&&"constructor"in e)return!1}r=r||[],n=n||[];for(var p=r.length;p--;)if(r[p]===t)return n[p]===e;if(r.push(t),n.push(e),s){if(p=t.length,p!==e.length)return!1;for(;p--;)if(!bt(t[p],e[p],r,n))return!1}else{var c=M(t),u;if(p=c.length,M(e).length!==p)return!1;for(;p--;)if(u=c[p],!(Ie(e,u)&&bt(t[u],e[u],r,n)))return!1}return r.pop(),n.pop(),!0}function Ms(t,e){return bt(t,e)}function Je(t){if(!Re(t))return[];var e=[];for(var r in t)e.push(r);return yn&&Dn(t,e),e}function Kt(t){var e=re(t);return function(r){if(r==null)return!1;var n=Je(r);if(re(n))return!1;for(var i=0;i<e;i++)if(!X(r[t[i]]))return!1;return t!==Bn||!X(r[Ht])}}var Ht="forEach",Mn="has",Wt=["clear","delete"],kn=["get",Mn,"set"],ks=Wt.concat(Ht,kn),Bn=Wt.concat(kn),Bs=["add"].concat(Wt,Ht,Mn);const Gs=zt?Kt(ks):W("Map"),qs=zt?Kt(Bn):W("WeakMap"),$s=zt?Kt(Bs):W("Set"),Us=W("WeakSet");function Ce(t){for(var e=M(t),r=e.length,n=Array(r),i=0;i<r;i++)n[i]=t[e[i]];return n}function zs(t){for(var e=M(t),r=e.length,n=Array(r),i=0;i<r;i++)n[i]=[e[i],t[e[i]]];return n}function Gn(t){for(var e={},r=M(t),n=0,i=r.length;n<i;n++)e[t[r[n]]]=r[n];return e}function Ot(t){var e=[];for(var r in t)X(t[r])&&e.push(r);return e.sort()}function Jt(t,e){return function(r){var n=arguments.length;if(e&&(r=Object(r)),n<2||r==null)return r;for(var i=1;i<n;i++)for(var s=arguments[i],o=t(s),a=o.length,l=0;l<a;l++){var p=o[l];(!e||r[p]===void 0)&&(r[p]=s[p])}return r}}const qn=Jt(Je),it=Jt(M),$n=Jt(Je,!0);function Vs(){return function(){}}function Un(t){if(!Re(t))return{};if(wr)return wr(t);var e=Vs();e.prototype=t;var r=new e;return e.prototype=null,r}function Ks(t,e){var r=Un(t);return e&&it(r,e),r}function Hs(t){return Re(t)?be(t)?t.slice():qn({},t):t}function Ws(t,e){return e(t),t}function zn(t){return be(t)?t:[t]}A.toPath=zn;function Xe(t){return A.toPath(t)}function Xt(t,e){for(var r=e.length,n=0;n<r;n++){if(t==null)return;t=t[e[n]]}return r?t:void 0}function Vn(t,e,r){var n=Xt(t,Xe(e));return _n(n)?r:n}function Js(t,e){e=Xe(e);for(var r=e.length,n=0;n<r;n++){var i=e[n];if(!Ie(t,i))return!1;t=t[i]}return!!r}function jt(t){return t}function $e(t){return t=it({},t),function(e){return Cn(e,t)}}function Qt(t){return t=Xe(t),function(e){return Xt(e,t)}}function je(t,e,r){if(e===void 0)return t;switch(r??3){case 1:return function(n){return t.call(e,n)};case 3:return function(n,i,s){return t.call(e,n,i,s)};case 4:return function(n,i,s,o){return t.call(e,n,i,s,o)}}return function(){return t.apply(e,arguments)}}function Kn(t,e,r){return t==null?jt:X(t)?je(t,e,r):Re(t)&&!be(t)?$e(t):Qt(t)}function Yt(t,e){return Kn(t,e,1/0)}A.iteratee=Yt;function se(t,e,r){return A.iteratee!==Yt?A.iteratee(t,e):Kn(t,e,r)}function Xs(t,e,r){e=se(e,r);for(var n=M(t),i=n.length,s={},o=0;o<i;o++){var a=n[o];s[a]=e(t[a],a,t)}return s}function Hn(){}function js(t){return t==null?Hn:function(e){return Vn(t,e)}}function Qs(t,e,r){var n=Array(Math.max(0,t));e=je(e,r,1);for(var i=0;i<t;i++)n[i]=e(i);return n}function Lt(t,e){return e==null&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))}const Ue=Date.now||function(){return new Date().getTime()};function Wn(t){var e=function(s){return t[s]},r="(?:"+M(t).join("|")+")",n=RegExp(r),i=RegExp(r,"g");return function(s){return s=s==null?"":""+s,n.test(s)?s.replace(i,e):s}}const Jn={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},Ys=Wn(Jn),Zs=Gn(Jn),eo=Wn(Zs),to=A.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var gt=/(.)^/,ro={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},no=/\\|'|\r|\n|\u2028|\u2029/g;function io(t){return"\\"+ro[t]}var so=/^\s*(\w|\$)+\s*$/;function oo(t,e,r){!e&&r&&(e=r),e=$n({},e,A.templateSettings);var n=RegExp([(e.escape||gt).source,(e.interpolate||gt).source,(e.evaluate||gt).source].join("|")+"|$","g"),i=0,s="__p+='";t.replace(n,function(p,c,u,h,m){return s+=t.slice(i,m).replace(no,io),i=m+p.length,c?s+=`'+
((__t=(`+c+`))==null?'':_.escape(__t))+
'`:u?s+=`'+
((__t=(`+u+`))==null?'':__t)+
'`:h&&(s+=`';
`+h+`
__p+='`),p}),s+=`';
`;var o=e.variable;if(o){if(!so.test(o))throw new Error("variable is not a bare identifier: "+o)}else s=`with(obj||{}){
`+s+`}
`,o="obj";s=`var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};
`+s+`return __p;
`;var a;try{a=new Function(o,"_",s)}catch(p){throw p.source=s,p}var l=function(p){return a.call(this,p,A)};return l.source="function("+o+`){
`+s+"}",l}function ao(t,e,r){e=Xe(e);var n=e.length;if(!n)return X(r)?r.call(t):r;for(var i=0;i<n;i++){var s=t==null?void 0:t[e[i]];s===void 0&&(s=r,i=n),t=X(s)?s.call(t):s}return t}var lo=0;function uo(t){var e=++lo+"";return t?t+e:e}function co(t){var e=A(t);return e._chain=!0,e}function Xn(t,e,r,n,i){if(!(n instanceof e))return t.apply(r,i);var s=Un(t.prototype),o=t.apply(s,i);return Re(o)?o:s}var Te=te(function(t,e){var r=Te.placeholder,n=function(){for(var i=0,s=e.length,o=Array(s),a=0;a<s;a++)o[a]=e[a]===r?arguments[i++]:e[a];for(;i<arguments.length;)o.push(arguments[i++]);return Xn(t,n,this,this,o)};return n});Te.placeholder=A;const jn=te(function(t,e,r){if(!X(t))throw new TypeError("Bind must be called on a function");var n=te(function(i){return Xn(t,n,e,this,r.concat(i))});return n}),oe=Pn(re);function Oe(t,e,r,n){if(n=n||[],!e&&e!==0)e=1/0;else if(e<=0)return n.concat(t);for(var i=n.length,s=0,o=re(t);s<o;s++){var a=t[s];if(oe(a)&&(be(a)||Vt(a)))if(e>1)Oe(a,e-1,r,n),i=n.length;else for(var l=0,p=a.length;l<p;)n[i++]=a[l++];else r||(n[i++]=a)}return n}const po=te(function(t,e){e=Oe(e,!1,!1);var r=e.length;if(r<1)throw new Error("bindAll must be passed function names");for(;r--;){var n=e[r];t[n]=jn(t[n],t)}return t});function ho(t,e){var r=function(n){var i=r.cache,s=""+(e?e.apply(this,arguments):n);return Ie(i,s)||(i[s]=t.apply(this,arguments)),i[s]};return r.cache={},r}const Qn=te(function(t,e,r){return setTimeout(function(){return t.apply(null,r)},e)}),fo=Te(Qn,A,1);function mo(t,e,r){var n,i,s,o,a=0;r||(r={});var l=function(){a=r.leading===!1?0:Ue(),n=null,o=t.apply(i,s),n||(i=s=null)},p=function(){var c=Ue();!a&&r.leading===!1&&(a=c);var u=e-(c-a);return i=this,s=arguments,u<=0||u>e?(n&&(clearTimeout(n),n=null),a=c,o=t.apply(i,s),n||(i=s=null)):!n&&r.trailing!==!1&&(n=setTimeout(l,u)),o};return p.cancel=function(){clearTimeout(n),a=0,n=i=s=null},p}function go(t,e,r){var n,i,s,o,a,l=function(){var c=Ue()-i;e>c?n=setTimeout(l,e-c):(n=null,r||(o=t.apply(a,s)),n||(s=a=null))},p=te(function(c){return a=this,s=c,i=Ue(),n||(n=setTimeout(l,e),r&&(o=t.apply(a,s))),o});return p.cancel=function(){clearTimeout(n),n=s=a=null},p}function vo(t,e){return Te(e,t)}function Zt(t){return function(){return!t.apply(this,arguments)}}function Io(){var t=arguments,e=t.length-1;return function(){for(var r=e,n=t[e].apply(this,arguments);r--;)n=t[r].call(this,n);return n}}function yo(t,e){return function(){if(--t<1)return e.apply(this,arguments)}}function Yn(t,e){var r;return function(){return--t>0&&(r=e.apply(this,arguments)),t<=1&&(e=null),r}}const _o=Te(Yn,2);function Zn(t,e,r){e=se(e,r);for(var n=M(t),i,s=0,o=n.length;s<o;s++)if(i=n[s],e(t[i],i,t))return i}function ei(t){return function(e,r,n){r=se(r,n);for(var i=re(e),s=t>0?0:i-1;s>=0&&s<i;s+=t)if(r(e[s],s,e))return s;return-1}}const er=ei(1),ti=ei(-1);function ri(t,e,r,n){r=se(r,n,1);for(var i=r(e),s=0,o=re(t);s<o;){var a=Math.floor((s+o)/2);r(t[a])<i?s=a+1:o=a}return s}function ni(t,e,r){return function(n,i,s){var o=0,a=re(n);if(typeof s=="number")t>0?o=s>=0?s:Math.max(s+a,o):a=s>=0?Math.min(s+1,a):s+a+1;else if(r&&s&&a)return s=r(n,i),n[s]===i?s:-1;if(i!==i)return s=e(We.call(n,o,a),On),s>=0?s+o:-1;for(s=t>0?o:a-1;s>=0&&s<a;s+=t)if(n[s]===i)return s;return-1}}const ii=ni(1,er,ri),So=ni(-1,ti);function Pt(t,e,r){var n=oe(t)?er:Zn,i=n(t,e,r);if(i!==void 0&&i!==-1)return t[i]}function Ao(t,e){return Pt(t,$e(e))}function he(t,e,r){e=je(e,r);var n,i;if(oe(t))for(n=0,i=t.length;n<i;n++)e(t[n],n,t);else{var s=M(t);for(n=0,i=s.length;n<i;n++)e(t[s[n]],s[n],t)}return t}function Ae(t,e,r){e=se(e,r);for(var n=!oe(t)&&M(t),i=(n||t).length,s=Array(i),o=0;o<i;o++){var a=n?n[o]:o;s[o]=e(t[a],a,t)}return s}function si(t){var e=function(r,n,i,s){var o=!oe(r)&&M(r),a=(o||r).length,l=t>0?0:a-1;for(s||(i=r[o?o[l]:l],l+=t);l>=0&&l<a;l+=t){var p=o?o[l]:l;i=n(i,r[p],p,r)}return i};return function(r,n,i,s){var o=arguments.length>=3;return e(r,je(n,s,4),i,o)}}const vt=si(1),Or=si(-1);function Pe(t,e,r){var n=[];return e=se(e,r),he(t,function(i,s,o){e(i,s,o)&&n.push(i)}),n}function wo(t,e,r){return Pe(t,Zt(se(e)),r)}function Lr(t,e,r){e=se(e,r);for(var n=!oe(t)&&M(t),i=(n||t).length,s=0;s<i;s++){var o=n?n[s]:s;if(!e(t[o],o,t))return!1}return!0}function Pr(t,e,r){e=se(e,r);for(var n=!oe(t)&&M(t),i=(n||t).length,s=0;s<i;s++){var o=n?n[s]:s;if(e(t[o],o,t))return!0}return!1}function ce(t,e,r,n){return oe(t)||(t=Ce(t)),(typeof r!="number"||n)&&(r=0),ii(t,e,r)>=0}const xo=te(function(t,e,r){var n,i;return X(e)?i=e:(e=Xe(e),n=e.slice(0,-1),e=e[e.length-1]),Ae(t,function(s){var o=i;if(!o){if(n&&n.length&&(s=Xt(s,n)),s==null)return;o=s[e]}return o==null?o:o.apply(s,r)})});function tr(t,e){return Ae(t,Qt(e))}function No(t,e){return Pe(t,$e(e))}function oi(t,e,r){var n=-1/0,i=-1/0,s,o;if(e==null||typeof e=="number"&&typeof t[0]!="object"&&t!=null){t=oe(t)?t:Ce(t);for(var a=0,l=t.length;a<l;a++)s=t[a],s!=null&&s>n&&(n=s)}else e=se(e,r),he(t,function(p,c,u){o=e(p,c,u),(o>i||o===-1/0&&n===-1/0)&&(n=p,i=o)});return n}function Ro(t,e,r){var n=1/0,i=1/0,s,o;if(e==null||typeof e=="number"&&typeof t[0]!="object"&&t!=null){t=oe(t)?t:Ce(t);for(var a=0,l=t.length;a<l;a++)s=t[a],s!=null&&s<n&&(n=s)}else e=se(e,r),he(t,function(p,c,u){o=e(p,c,u),(o<i||o===1/0&&n===1/0)&&(n=p,i=o)});return n}var bo=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function ai(t){return t?be(t)?We.call(t):Ut(t)?t.match(bo):oe(t)?Ae(t,jt):Ce(t):[]}function li(t,e,r){if(e==null||r)return oe(t)||(t=Ce(t)),t[Lt(t.length-1)];var n=ai(t),i=re(n);e=Math.max(Math.min(e,i),0);for(var s=i-1,o=0;o<e;o++){var a=Lt(o,s),l=n[o];n[o]=n[a],n[a]=l}return n.slice(0,e)}function Oo(t){return li(t,1/0)}function Lo(t,e,r){var n=0;return e=se(e,r),tr(Ae(t,function(i,s,o){return{value:i,index:n++,criteria:e(i,s,o)}}).sort(function(i,s){var o=i.criteria,a=s.criteria;if(o!==a){if(o>a||o===void 0)return 1;if(o<a||a===void 0)return-1}return i.index-s.index}),"value")}function pt(t,e){return function(r,n,i){var s=e?[[],[]]:{};return n=se(n,i),he(r,function(o,a){var l=n(o,a,r);t(s,o,l)}),s}}const Po=pt(function(t,e,r){Ie(t,r)?t[r].push(e):t[r]=[e]}),Eo=pt(function(t,e,r){t[r]=e}),Fo=pt(function(t,e,r){Ie(t,r)?t[r]++:t[r]=1}),Do=pt(function(t,e,r){t[r?0:1].push(e)},!0);function Co(t){return t==null?0:oe(t)?t.length:M(t).length}function To(t,e,r){return e in r}const ui=te(function(t,e){var r={},n=e[0];if(t==null)return r;X(n)?(e.length>1&&(n=je(n,e[1])),e=Je(t)):(n=To,e=Oe(e,!1,!1),t=Object(t));for(var i=0,s=e.length;i<s;i++){var o=e[i],a=t[o];n(a,o,t)&&(r[o]=a)}return r}),Mo=te(function(t,e){var r=e[0],n;return X(r)?(r=Zt(r),e.length>1&&(n=e[1])):(e=Ae(Oe(e,!1,!1),String),r=function(i,s){return!ce(e,s)}),ui(t,r,n)});function ci(t,e,r){return We.call(t,0,Math.max(0,t.length-(e==null||r?1:e)))}function It(t,e,r){return t==null||t.length<1?e==null||r?void 0:[]:e==null||r?t[0]:ci(t,t.length-e)}function Qe(t,e,r){return We.call(t,e==null||r?1:e)}function ko(t,e,r){return t==null||t.length<1?e==null||r?void 0:[]:e==null||r?t[t.length-1]:Qe(t,Math.max(0,t.length-e))}function Bo(t){return Pe(t,Boolean)}function Go(t,e){return Oe(t,e,!1)}const pi=te(function(t,e){return e=Oe(e,!0,!0),Pe(t,function(r){return!ce(e,r)})}),qo=te(function(t,e){return pi(t,e)});function Et(t,e,r,n){Sn(e)||(n=r,r=e,e=!1),r!=null&&(r=se(r,n));for(var i=[],s=[],o=0,a=re(t);o<a;o++){var l=t[o],p=r?r(l,o,t):l;e&&!r?((!o||s!==p)&&i.push(l),s=p):r?ce(s,p)||(s.push(p),i.push(l)):ce(i,l)||i.push(l)}return i}const $o=te(function(t){return Et(Oe(t,!0,!0))});function Uo(t){for(var e=[],r=arguments.length,n=0,i=re(t);n<i;n++){var s=t[n];if(!ce(e,s)){var o;for(o=1;o<r&&ce(arguments[o],s);o++);o===r&&e.push(s)}}return e}function Ft(t){for(var e=t&&oi(t,re).length||0,r=Array(e),n=0;n<e;n++)r[n]=tr(t,n);return r}const zo=te(Ft);function Vo(t,e){for(var r={},n=0,i=re(t);n<i;n++)e?r[t[n]]=e[n]:r[t[n][0]]=t[n][1];return r}function Ko(t,e,r){e==null&&(e=t||0,t=0),r||(r=e<t?-1:1);for(var n=Math.max(Math.ceil((e-t)/r),0),i=Array(n),s=0;s<n;s++,t+=r)i[s]=t;return i}function Ho(t,e){if(e==null||e<1)return[];for(var r=[],n=0,i=t.length;n<i;)r.push(We.call(t,n,n+=e));return r}function rr(t,e){return t._chain?A(e).chain():e}function hi(t){return he(Ot(t),function(e){var r=A[e]=t[e];A.prototype[e]=function(){var n=[this._wrapped];return ds.apply(n,arguments),rr(this,r.apply(A,n))}}),A}he(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=ct[t];A.prototype[t]=function(){var r=this._wrapped;return r!=null&&(e.apply(r,arguments),(t==="shift"||t==="splice")&&r.length===0&&delete r[0]),rr(this,r)}});he(["concat","join","slice"],function(t){var e=ct[t];A.prototype[t]=function(){var r=this._wrapped;return r!=null&&(r=e.apply(r,arguments)),rr(this,r)}});const Wo=Object.freeze(Object.defineProperty({__proto__:null,VERSION:vn,after:yo,all:Lr,allKeys:Je,any:Pr,assign:it,before:Yn,bind:jn,bindAll:po,chain:co,chunk:Ho,clone:Hs,collect:Ae,compact:Bo,compose:Io,constant:Ln,contains:ce,countBy:Fo,create:Ks,debounce:go,default:A,defaults:$n,defer:fo,delay:Qn,detect:Pt,difference:pi,drop:Qe,each:he,escape:Ys,every:Lr,extend:qn,extendOwn:it,filter:Pe,find:Pt,findIndex:er,findKey:Zn,findLastIndex:ti,findWhere:Ao,first:It,flatten:Go,foldl:vt,foldr:Or,forEach:he,functions:Ot,get:Vn,groupBy:Po,has:Js,head:It,identity:jt,include:ce,includes:ce,indexBy:Eo,indexOf:ii,initial:ci,inject:vt,intersection:Uo,invert:Gn,invoke:xo,isArguments:Vt,isArray:be,isArrayBuffer:xn,isBoolean:Sn,isDataView:rt,isDate:xs,isElement:ws,isEmpty:Ts,isEqual:Ms,isError:Rs,isFinite:Ps,isFunction:X,isMap:Gs,isMatch:Cn,isNaN:On,isNull:As,isNumber:An,isObject:Re,isRegExp:Ns,isSet:$s,isString:Ut,isSymbol:wn,isTypedArray:Fn,isUndefined:_n,isWeakMap:qs,isWeakSet:Us,iteratee:Yt,keys:M,last:ko,lastIndexOf:So,map:Ae,mapObject:Xs,matcher:$e,matches:$e,max:oi,memoize:ho,methods:Ot,min:Ro,mixin:hi,negate:Zt,noop:Hn,now:Ue,object:Vo,omit:Mo,once:_o,pairs:zs,partial:Te,partition:Do,pick:ui,pluck:tr,property:Qt,propertyOf:js,random:Lt,range:Ko,reduce:vt,reduceRight:Or,reject:wo,rest:Qe,restArguments:te,result:ao,sample:li,select:Pe,shuffle:Oo,size:Co,some:Pr,sortBy:Lo,sortedIndex:ri,tail:Qe,take:It,tap:Ws,template:oo,templateSettings:to,throttle:mo,times:Qs,toArray:ai,toPath:zn,transpose:Ft,unescape:eo,union:$o,uniq:Et,unique:Et,uniqueId:uo,unzip:Ft,values:Ce,where:No,without:qo,wrap:vo,zip:zo},Symbol.toStringTag,{value:"Module"}));var Er=hi(Wo);Er._=Er;function Jo(t){let e,r,n,i,s,o;return{c(){e=O("span"),r=O("span"),n=$(t[0]),i=O("span"),s=$(t[0]),this.h()},l(a){e=L(a,"SPAN",{class:!0,style:!0});var l=P(e);r=L(l,"SPAN",{class:!0});var p=P(r);n=U(p,t[0]),p.forEach(S),i=L(l,"SPAN",{class:!0});var c=P(i);s=U(c,t[0]),c.forEach(S),l.forEach(S),this.h()},h(){b(r,"class","shadow svelte-fcg696"),b(i,"class","effect svelte-fcg696"),ue(i,"animated",t[1]),b(e,"class","component svelte-fcg696"),b(e,"style",o=`--idx: ${t[2]}`)},m(a,l){k(a,e,l),w(e,r),w(r,n),w(e,i),w(i,s)},p(a,[l]){l&1&&ae(n,a[0]),l&1&&ae(s,a[0]),l&2&&ue(i,"animated",a[1]),l&4&&o!==(o=`--idx: ${a[2]}`)&&b(e,"style",o)},i:Ye,o:Ye,d(a){a&&S(e)}}}function Xo(t,e,r){let{value:n}=e,{animated:i=!0}=e,{idx:s=0}=e;return t.$$set=o=>{"value"in o&&r(0,n=o.value),"animated"in o&&r(1,i=o.animated),"idx"in o&&r(2,s=o.idx)},[n,i,s]}class fi extends zr{constructor(e){super(),Vr(this,e,Xo,Jo,Ur,{value:0,animated:1,idx:2})}}function Fr(t,e,r){const n=t.slice();return n[15]=e[r],n}function Dr(t,e,r){const n=t.slice();return n[9]=e[r],n}function Cr(t,e,r){const n=t.slice();return n[12]=e[r],n}function jo(t){const e=t.slice(),r=e[4](e[7]);return e[8]=r,e}function Tr(t){const e=t.slice(),r=e[3];return e[7]=r,e}function Qo(t){let e,r,n,i,s,o;const a=[ea,Zo,Yo],l=[];function p(u,h){return h&8&&(r=null),h&8&&(n=null),r==null&&(r=!!me(u[7])),r?0:(n==null&&(n=!!pe(u[7])),n?1:2)}function c(u,h){return h===0?jo(u):u}return i=p(t,-1),s=l[i]=a[i](c(t,i)),{c(){e=O("span"),s.c(),this.h()},l(u){e=L(u,"SPAN",{class:!0});var h=P(e);s.l(h),h.forEach(S),this.h()},h(){b(e,"class","formula svelte-5zrt5h")},m(u,h){k(u,e,h),l[i].m(e,null),o=!0},p(u,h){let m=i;i=p(u,h),i===m?l[i].p(c(u,i),h):(Ee(),C(l[m],1,1,()=>{l[m]=null}),Fe(),s=l[i],s?s.p(c(u,i),h):(s=l[i]=a[i](c(u,i)),s.c()),F(s,1),s.m(e,null))},i(u){o||(F(s),o=!0)},o(u){C(s),o=!1},d(u){u&&S(e),l[i].d()}}}function Yo(t){let e,r,n=Math.abs(t[7])+"",i;function s(l,p){if(l[1]==="+")return ra;if(l[1]==="-")return ta}let o=s(t),a=o&&o(t);return{c(){e=O("span"),a&&a.c(),r=_e(),i=$(n),this.h()},l(l){e=L(l,"SPAN",{class:!0});var p=P(e);a&&a.l(p),r=Se(p),i=U(p,n),p.forEach(S),this.h()},h(){b(e,"class","literal")},m(l,p){k(l,e,p),a&&a.m(e,null),w(e,r),w(e,i)},p(l,p){o===(o=s(l))&&a?a.p(l,p):(a&&a.d(1),a=o&&o(l),a&&(a.c(),a.m(e,r))),p&8&&n!==(n=Math.abs(l[7])+"")&&ae(i,n)},i:Ye,o:Ye,d(l){l&&S(e),a&&a.d()}}}function Zo(t){let e,r,n,i=(t[7].results.length===1?"":t[7].results.length)+"",s,o,a=t[7].sides+"",l,p,c,u,h=t[1]&&Mr(t),m=Le(t[7].results),d=[];for(let f=0;f<m.length;f+=1)d[f]=kr(Fr(t,m,f));const g=f=>C(d[f],1,1,()=>{d[f]=null});return{c(){e=O("span"),h&&h.c(),r=_e(),n=O("span"),s=$(i),o=$("d"),l=$(a),p=_e(),c=O("span");for(let f=0;f<d.length;f+=1)d[f].c();this.h()},l(f){e=L(f,"SPAN",{class:!0});var v=P(e);h&&h.l(v),r=Se(v),n=L(v,"SPAN",{class:!0});var _=P(n);s=U(_,i),o=U(_,"d"),l=U(_,a),_.forEach(S),p=Se(v),c=L(v,"SPAN",{class:!0});var y=P(c);for(let N=0;N<d.length;N+=1)d[N].l(y);y.forEach(S),v.forEach(S),this.h()},h(){b(n,"class","spec"),b(c,"class","dice-results svelte-5zrt5h"),b(e,"class","dice")},m(f,v){k(f,e,v),h&&h.m(e,null),w(e,r),w(e,n),w(n,s),w(n,o),w(n,l),w(e,p),w(e,c);for(let _=0;_<d.length;_+=1)d[_]&&d[_].m(c,null);u=!0},p(f,v){if(f[1]?h?h.p(f,v):(h=Mr(f),h.c(),h.m(e,r)):h&&(h.d(1),h=null),(!u||v&8)&&i!==(i=(f[7].results.length===1?"":f[7].results.length)+"")&&ae(s,i),(!u||v&8)&&a!==(a=f[7].sides+"")&&ae(l,a),v&12){m=Le(f[7].results);let _;for(_=0;_<m.length;_+=1){const y=Fr(f,m,_);d[_]?(d[_].p(y,v),F(d[_],1)):(d[_]=kr(y),d[_].c(),F(d[_],1),d[_].m(c,null))}for(Ee(),_=m.length;_<d.length;_+=1)g(_);Fe()}},i(f){if(!u){for(let v=0;v<m.length;v+=1)F(d[v]);u=!0}},o(f){d=d.filter(Boolean);for(let v=0;v<d.length;v+=1)C(d[v]);u=!1},d(f){f&&S(e),h&&h.d(),Dt(d,f)}}}function ea(t){let e,r,n,i;const s=[ia,na],o=[];function a(l,p){return l[8]?0:1}return e=a(t),r=o[e]=s[e](t),{c(){r.c(),n=Ze()},l(l){r.l(l),n=Ze()},m(l,p){o[e].m(l,p),k(l,n,p),i=!0},p(l,p){let c=e;e=a(l),e===c?o[e].p(l,p):(Ee(),C(o[c],1,1,()=>{o[c]=null}),Fe(),r=o[e],r?r.p(l,p):(r=o[e]=s[e](l),r.c()),F(r,1),r.m(n.parentNode,n))},i(l){i||(F(r),i=!0)},o(l){C(r),i=!1},d(l){l&&S(n),o[e].d(l)}}}function ta(t){let e,r=t[7]>=0?"-":"+",n;return{c(){e=O("span"),n=$(r),this.h()},l(i){e=L(i,"SPAN",{class:!0});var s=P(e);n=U(s,r),s.forEach(S),this.h()},h(){b(e,"class","operator svelte-5zrt5h")},m(i,s){k(i,e,s),w(e,n)},p(i,s){s&8&&r!==(r=i[7]>=0?"-":"+")&&ae(n,r)},d(i){i&&S(e)}}}function ra(t){let e,r=t[7]>=0?"+":"-",n;return{c(){e=O("span"),n=$(r),this.h()},l(i){e=L(i,"SPAN",{class:!0});var s=P(e);n=U(s,r),s.forEach(S),this.h()},h(){b(e,"class","operator svelte-5zrt5h")},m(i,s){k(i,e,s),w(e,n)},p(i,s){s&8&&r!==(r=i[7]>=0?"+":"-")&&ae(n,r)},d(i){i&&S(e)}}}function Mr(t){let e,r;return{c(){e=O("span"),r=$(t[1]),this.h()},l(n){e=L(n,"SPAN",{class:!0});var i=P(e);r=U(i,t[1]),i.forEach(S),this.h()},h(){b(e,"class","operator svelte-5zrt5h")},m(n,i){k(n,e,i),w(e,r)},p(n,i){i&2&&ae(r,n[1])},d(n){n&&S(e)}}}function kr(t){let e,r,n;return r=new fi({props:{value:t[15],animated:t[2]}}),{c(){e=O("span"),ze(r.$$.fragment),this.h()},l(i){e=L(i,"SPAN",{class:!0});var s=P(e);Ve(r.$$.fragment,s),s.forEach(S),this.h()},h(){b(e,"class","dice-result svelte-5zrt5h")},m(i,s){k(i,e,s),Ke(r,e,null),n=!0},p(i,s){const o={};s&8&&(o.value=i[15]),s&4&&(o.animated=i[2]),r.$set(o)},i(i){n||(F(r.$$.fragment,i),n=!0)},o(i){C(r.$$.fragment,i),n=!1},d(i){i&&S(e),He(r)}}}function na(t){let e,r,n,i,s,o,a,l,p,c,u=t[1]&&Br(t);i=new nr({props:{roll:t[7].rolls[0]}});const h=[oa,sa],m=[];function d(g,f){return f&1&&(a=null),a==null&&(a=!!Gt(g[0])),a?0:1}return l=d(t,-1),p=m[l]=h[l](t),{c(){e=O("span"),u&&u.c(),r=_e(),n=O("span"),ze(i.$$.fragment),s=_e(),o=O("span"),p.c(),this.h()},l(g){e=L(g,"SPAN",{class:!0});var f=P(e);u&&u.l(f),r=Se(f),n=L(f,"SPAN",{class:!0});var v=P(n);Ve(i.$$.fragment,v),v.forEach(S),s=Se(f),o=L(f,"SPAN",{});var _=P(o);p.l(_),_.forEach(S),f.forEach(S),this.h()},h(){b(n,"class","roll svelte-5zrt5h"),b(e,"class","binary svelte-5zrt5h"),ue(e,"add",t[7].mode==="ADD"),ue(e,"sub",t[7].mode==="SUB"),ue(e,"min",t[7].mode==="MIN"),ue(e,"max",t[7].mode==="MAX")},m(g,f){k(g,e,f),u&&u.m(e,null),w(e,r),w(e,n),Ke(i,n,null),w(e,s),w(e,o),m[l].m(o,null),c=!0},p(g,f){g[1]?u?u.p(g,f):(u=Br(g),u.c(),u.m(e,r)):u&&(u.d(1),u=null);const v={};f&8&&(v.roll=g[7].rolls[0]),i.$set(v);let _=l;l=d(g,f),l===_?m[l].p(g,f):(Ee(),C(m[_],1,1,()=>{m[_]=null}),Fe(),p=m[l],p?p.p(g,f):(p=m[l]=h[l](g),p.c()),F(p,1),p.m(o,null)),(!c||f&8)&&ue(e,"add",g[7].mode==="ADD"),(!c||f&8)&&ue(e,"sub",g[7].mode==="SUB"),(!c||f&8)&&ue(e,"min",g[7].mode==="MIN"),(!c||f&8)&&ue(e,"max",g[7].mode==="MAX")},i(g){c||(F(i.$$.fragment,g),F(p),c=!0)},o(g){C(i.$$.fragment,g),C(p),c=!1},d(g){g&&S(e),u&&u.d(),He(i),m[l].d()}}}function ia(t){let e,r,n,i=(t[8].results[0].length===1?"":t[8].results[0].length)+"",s,o,a=t[8].sides+"",l,p,c,u,h=t[1]&&Gr(t);function m(y,N){if(y[8].kind==="ADVANTAGE")return la;if(y[8].kind==="DISADVANTAGE")return aa}let d=m(t),g=d&&d(t),f=Le(t[8].results),v=[];for(let y=0;y<f.length;y+=1)v[y]=$r(Dr(t,f,y));const _=y=>C(v[y],1,1,()=>{v[y]=null});return{c(){e=O("span"),h&&h.c(),r=_e(),n=O("span"),s=$(i),o=$("d"),l=$(a),g&&g.c(),p=_e(),c=O("span");for(let y=0;y<v.length;y+=1)v[y].c();this.h()},l(y){e=L(y,"SPAN",{class:!0});var N=P(e);h&&h.l(N),r=Se(N),n=L(N,"SPAN",{class:!0});var R=P(n);s=U(R,i),o=U(R,"d"),l=U(R,a),g&&g.l(R),R.forEach(S),p=Se(N),c=L(N,"SPAN",{class:!0});var Me=P(c);for(let ht=0;ht<v.length;ht+=1)v[ht].l(Me);Me.forEach(S),N.forEach(S),this.h()},h(){b(n,"class","spec"),b(c,"class","dice-results svelte-5zrt5h"),b(e,"class","advantage")},m(y,N){k(y,e,N),h&&h.m(e,null),w(e,r),w(e,n),w(n,s),w(n,o),w(n,l),g&&g.m(n,null),w(e,p),w(e,c);for(let R=0;R<v.length;R+=1)v[R]&&v[R].m(c,null);u=!0},p(y,N){if(y[1]?h?h.p(y,N):(h=Gr(y),h.c(),h.m(e,r)):h&&(h.d(1),h=null),(!u||N&8)&&i!==(i=(y[8].results[0].length===1?"":y[8].results[0].length)+"")&&ae(s,i),(!u||N&8)&&a!==(a=y[8].sides+"")&&ae(l,a),d!==(d=m(y))&&(g&&g.d(1),g=d&&d(y),g&&(g.c(),g.m(n,null))),N&28){f=Le(y[8].results);let R;for(R=0;R<f.length;R+=1){const Me=Dr(y,f,R);v[R]?(v[R].p(Me,N),F(v[R],1)):(v[R]=$r(Me),v[R].c(),F(v[R],1),v[R].m(c,null))}for(Ee(),R=f.length;R<v.length;R+=1)_(R);Fe()}},i(y){if(!u){for(let N=0;N<f.length;N+=1)F(v[N]);u=!0}},o(y){v=v.filter(Boolean);for(let N=0;N<v.length;N+=1)C(v[N]);u=!1},d(y){y&&S(e),h&&h.d(),g&&g.d(),Dt(v,y)}}}function Br(t){let e,r;return{c(){e=O("span"),r=$(t[1]),this.h()},l(n){e=L(n,"SPAN",{class:!0});var i=P(e);r=U(i,t[1]),i.forEach(S),this.h()},h(){b(e,"class","operator svelte-5zrt5h")},m(n,i){k(n,e,i),w(e,r)},p(n,i){i&2&&ae(r,n[1])},d(n){n&&S(e)}}}function sa(t){let e,r;return e=new nr({props:{roll:t[7].rolls[1]}}),{c(){ze(e.$$.fragment)},l(n){Ve(e.$$.fragment,n)},m(n,i){Ke(e,n,i),r=!0},p(n,i){const s={};i&8&&(s.roll=n[7].rolls[1]),e.$set(s)},i(n){r||(F(e.$$.fragment,n),r=!0)},o(n){C(e.$$.fragment,n),r=!1},d(n){He(e,n)}}}function oa(t){let e,r;return e=new nr({props:{roll:t[7].rolls[1],sign:t[5](t[7],t[1]??"+")}}),{c(){ze(e.$$.fragment)},l(n){Ve(e.$$.fragment,n)},m(n,i){Ke(e,n,i),r=!0},p(n,i){const s={};i&8&&(s.roll=n[7].rolls[1]),i&10&&(s.sign=n[5](n[7],n[1]??"+")),e.$set(s)},i(n){r||(F(e.$$.fragment,n),r=!0)},o(n){C(e.$$.fragment,n),r=!1},d(n){He(e,n)}}}function Gr(t){let e,r;return{c(){e=O("span"),r=$(t[1]),this.h()},l(n){e=L(n,"SPAN",{class:!0});var i=P(e);r=U(i,t[1]),i.forEach(S),this.h()},h(){b(e,"class","operator svelte-5zrt5h")},m(n,i){k(n,e,i),w(e,r)},p(n,i){i&2&&ae(r,n[1])},d(n){n&&S(e)}}}function aa(t){let e;return{c(){e=$("d")},l(r){e=U(r,"d")},m(r,n){k(r,e,n)},d(r){r&&S(e)}}}function la(t){let e;return{c(){e=$("a")},l(r){e=U(r,"a")},m(r,n){k(r,e,n)},d(r){r&&S(e)}}}function qr(t){let e,r,n;return r=new fi({props:{value:t[12],animated:t[2]}}),{c(){e=O("span"),ze(r.$$.fragment),this.h()},l(i){e=L(i,"SPAN",{class:!0});var s=P(e);Ve(r.$$.fragment,s),s.forEach(S),this.h()},h(){b(e,"class","dice-result svelte-5zrt5h")},m(i,s){k(i,e,s),Ke(r,e,null),n=!0},p(i,s){const o={};s&8&&(o.value=i[12]),s&4&&(o.animated=i[2]),r.$set(o)},i(i){n||(F(r.$$.fragment,i),n=!0)},o(i){C(r.$$.fragment,i),n=!1},d(i){i&&S(e),He(r)}}}function $r(t){let e,r,n=Le(t[9]),i=[];for(let o=0;o<n.length;o+=1)i[o]=qr(Cr(t,n,o));const s=o=>C(i[o],1,1,()=>{i[o]=null});return{c(){e=O("span");for(let o=0;o<i.length;o+=1)i[o].c();this.h()},l(o){e=L(o,"SPAN",{class:!0});var a=P(e);for(let l=0;l<i.length;l+=1)i[l].l(a);a.forEach(S),this.h()},h(){b(e,"class","dice-result-group svelte-5zrt5h")},m(o,a){k(o,e,a);for(let l=0;l<i.length;l+=1)i[l]&&i[l].m(e,null);r=!0},p(o,a){if(a&28){n=Le(o[9]);let l;for(l=0;l<n.length;l+=1){const p=Cr(o,n,l);i[l]?(i[l].p(p,a),F(i[l],1)):(i[l]=qr(p),i[l].c(),F(i[l],1),i[l].m(e,null))}for(Ee(),l=n.length;l<i.length;l+=1)s(l);Fe()}},i(o){if(!r){for(let a=0;a<n.length;a+=1)F(i[a]);r=!0}},o(o){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)C(i[a]);r=!1},d(o){o&&S(e),Dt(i,o)}}}function ua(t){let e,r,n=Qo(Tr(t));return{c(){n&&n.c(),e=Ze()},l(i){n&&n.l(i),e=Ze()},m(i,s){n&&n.m(i,s),k(i,e,s),r=!0},p(i,[s]){n.p(Tr(i),s)},i(i){r||(F(n),r=!0)},o(i){C(n),r=!1},d(i){i&&S(e),n&&n.d(i)}}}function ca(t,e,r){let{roll:n}=e,{sign:i=void 0}=e,{animated:s=!0}=e,{idx:o=0}=e,a;function l(c){if(us(c)&&c.rolls.every(u=>pe(u))){const u=c.rolls;return u[0].sides!==u[1].sides&&u[0].results.length!==u[1].results.length?void 0:{kind:c.mode===mn.MIN?"DISADVANTAGE":"ADVANTAGE",sides:u[0].sides,results:u.map(h=>h.results)}}}function p(c,u){const h=u==="-";return Gt(c)?h?c.mode==="ADD"?"-":"+":c.mode==="ADD"?"+":"-":h?"-":"+"}return t.$$set=c=>{"roll"in c&&r(0,n=c.roll),"sign"in c&&r(1,i=c.sign),"animated"in c&&r(2,s=c.animated),"idx"in c&&r(6,o=c.idx)},t.$$.update=()=>{t.$$.dirty&1&&r(3,a=qt(n))},[n,i,s,a,l,p,o]}class nr extends zr{constructor(e){super(),Vr(this,e,ca,ua,Ur,{roll:0,sign:1,animated:2,idx:6})}}export{mn as B,fs as P,nr as R,Er as _,ma as a,yr as b,ms as c,cs as d,dn as e,da as f,de as g,ga as i,va as p,ps as r,qt as s};
